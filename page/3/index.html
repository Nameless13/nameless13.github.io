<!doctype html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.1" />






<meta name="description" content="90后，桶装水保洁工程狮，ಥ_ಥ">
<meta property="og:type" content="website">
<meta property="og:title" content="Nameless13">
<meta property="og:url" content="https://nameless13.github.io/page/3/index.html">
<meta property="og:site_name" content="Nameless13">
<meta property="og:description" content="90后，桶装水保洁工程狮，ಥ_ಥ">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Nameless13">
<meta name="twitter:description" content="90后，桶装水保洁工程狮，ಥ_ಥ">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: 'J3OX6892F7',
      apiKey: '38852eb9095216f8f2ada575a06a9cfc',
      indexName: 'Blog',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://nameless13.github.io/page/3/"/>





  <title>Nameless13</title>
  














</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Nameless13</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://nameless13.github.io/CDH/Installation/操作系统镜像初始化(裸金属主机).html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Nameless13">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Nameless13">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/CDH/Installation/操作系统镜像初始化(裸金属主机).html" itemprop="url">操作系统镜像初始化(裸金属主机)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-05-23T09:57:35+08:00">
                2018-05-23
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/CDH/" itemprop="url" rel="index">
                    <span itemprop="name">CDH</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/CDH/Installation/" itemprop="url" rel="index">
                    <span itemprop="name">Installation</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="资源池环境搭建"><a href="#资源池环境搭建" class="headerlink" title="资源池环境搭建"></a>资源池环境搭建</h1><p>最终给到手的机器 DELL730(单独做无存储计算节点)，系统盘800G，加8块960Gssd，外加1.6TFlash,在这台上面做初始化配置好了再做个最终使用的镜像。</p>
<h2 id="操作系统配置准备"><a href="#操作系统配置准备" class="headerlink" title="操作系统配置准备"></a>操作系统配置准备</h2><ol>
<li><p>建议对操作系统盘做RAID1</p>
</li>
<li><p>需要配置OS的repository，以便yum可以访问OS镜像[需要 createrepo httpd python-psycopg2 krb5*]</p>
<p><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">find /etc/yum.repos.d/ -name &quot;*.repo&quot; -exec mv &#123;&#125; &#123;&#125;.bak \; </div><div class="line">rpm -ivh --force --nodeps http://10.200.40.49/pub/centos-release-el6.noarch.rpm</div><div class="line">yum clean all</div><div class="line">yum makecache</div></pre></td></tr></table></figure>
</p>
</li>
<li><p>配置静态IP地址</p>
</li>
<li><p>需要所有主机/etc/hosts内容一致确保静态DNS解析</p>
</li>
<li><p>需要使用root用户 或者创建一个无密码使用sudo权限的其他用户[uid必须保持一致]<br>devops 4[&amp;3bFaK4g[U</p>
</li>
<li><p>关闭并禁用iptables</p>
</li>
<li><p>关闭SELinux<br><code>echo &quot;SELINUX=disabled&quot; &gt; /etc/sysconfig/selinux;</code></p>
</li>
<li><p>重启网络服务，并初始化网络<br><code>/etc/init.d/network restart</code></p>
</li>
<li><p>修改transparent_hugepage参数<br><code>echo never &gt; /sys/kernel/mm/transparent_hugepage/enabled</code><br><code>echo never &gt; /sys/kernel/mm/transparent_hugepage/defrag</code><br>同时确保开机自动关闭transparent_hugepage<br><code>vi /etc/rc.d/rc.local</code></p>
<p><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">#!/bin/bash</div><div class="line"># THIS FILE IS ADDED FOR COMPATIBILITY PURPOSES</div><div class="line">#</div><div class="line"># It is highly advisable to create own systemd services or udev rules</div><div class="line"># to run scripts during boot instead of using this file.</div><div class="line">#</div><div class="line"># In contrast to previous versions due to parallel execution during boot</div><div class="line"># this script will NOT be run after all other services.</div><div class="line">#</div><div class="line"># Please note that you must run &apos;chmod +x /etc/rc.d/rc.local&apos; to ensure</div><div class="line"># that this script will be executed during boot.</div><div class="line"></div><div class="line">touch /var/lock/subsys/local</div><div class="line"></div><div class="line">if test -f /sys/kernel/mm/transparent_hugepage/enabled; then</div><div class="line">echo never &gt; /sys/kernel/mm/transparent_hugepage/enabled</div><div class="line">fi</div><div class="line">if test -f /sys/kernel/mm/transparent_hugepage/defrag; then</div><div class="line">echo never &gt; /sys/kernel/mm/transparent_hugepage/defrag</div><div class="line">fi</div></pre></td></tr></table></figure>
</p>
<p>最后给rc.local赋予执行权限 <code>chmod +x /etc/rc.d/rc.local</code></p>
</li>
<li><p>禁用交换内存</p>
<p><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">echo 0 &gt;/proc/sys/vm/swappiness</div><div class="line">echo &apos;vm.swappiness=0&apos;&gt;&gt; /etc/sysctl.conf</div><div class="line">cat /proc/sys/vm/swappiness</div></pre></td></tr></table></figure>
</p>
</li>
<li><p>修改/etc/security/limits.conf或者在/etc/security/limits.d下增加相应的配置文件 </p>
<p><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">* soft noproc 11000</div><div class="line">* hard noproc 11000</div><div class="line">* soft nofile 65535</div><div class="line">* hard nofile 65535</div></pre></td></tr></table></figure>
</p>
</li>
<li><p>需要统一开启ntp服务,并且开机启动<br>在集群中选择一台机器作为ntp服务器，剩余的作为ntp客户端。所有客户端时间与ntp服务器保持同步。<br><code>vi /etc/ntp.conf</code><br>ntp同步ip地址和鹏博士的保持一致:</p>
<p>&lt;!--     server 64.113.32.5
server 216.229.0.179 --&gt;
</p>
<p>server 10.200.92.18<br>server 10.200.92.20 </p>
<p>systemctl start ntpd.service<br>systemctl enable ntpd.service</p>
<p>[root@nm-2 ~]# ntpq -p</p>
<pre><code>remote           refid      st t when poll reach   delay   offset  jitter

</code></pre><p>==============================================================================<br> nist.netservice .ACTS.           1 u    7   64    1  238.736   -7.477   0.000<br> nist1-lnk.binar .ACTS.           1 u    6   64    1  234.281   -6.177   0.000</p>
<p>systemctl disable chronyd 会影响ntp服务的开机启动所以禁用掉了</p>
</li>
</ol>
<ol>
<li>同时配置spark2.2需要java8环境<br>创建JDBC存放目录<code>mkdir -p /usr/java/</code><br>解压所给的tar包</li>
</ol>
<ol>
<li><p>禁用IPV6</p>
</li>
<li><p>准备jdbc连接mysql的jar包<br>[root@nm-7 ~]# mkdir /usr/share/java<br>[root@nm-7 ~]# ln -s /usr/share/java/mysql-connector-java-5.1.38-bin.jar /usr/share/java/mysql-connector-java.jar</p>
</li>
</ol>
<p><a href="http://detail.zol.com.cn/400/399822/param.shtml" target="_blank" rel="noopener">http://detail.zol.com.cn/400/399822/param.shtml</a> Intel Xeon E5-2640 v3参数<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">基本参数    </div><div class="line">CPU系列Xeon E5-2600 v3系列</div><div class="line">制作工艺22纳米</div><div class="line">核心代号Haswell</div><div class="line">性能参数    </div><div class="line">核心数量八核心</div><div class="line">线程数量十六线程</div><div class="line">CPU主频2.6GHz</div><div class="line">L3缓存20MB</div><div class="line">总线规格QPI 8GT/s</div><div class="line">热设计功耗(TDP)90W</div><div class="line">内存规格    </div><div class="line">支持最大内存容量768GB</div><div class="line">内存类型DDR4 1600/1866MHz</div><div class="line">内存描述DDR4 1600/1866MHz 技术</div><div class="line">封装规格    </div><div class="line">插槽类型LGA 2011-3</div><div class="line">封装大小45×52.5mm</div><div class="line">最高容许温度(Tcase)74.3°C</div><div class="line">最大CPU配置2颗</div><div class="line">技术参数    </div><div class="line">睿频加速技术支持，2.0</div><div class="line">超线程技术支持</div><div class="line">虚拟化技术Intel VT-x</div><div class="line">指令集AVX 2.0，64bit</div><div class="line">64位处理器支持</div><div class="line">其它技术支持博锐技术 ，定向I/O虚拟化技术，增强型SpeedStep技术，按需配电技术，温度监视技术，数据保护技术，平台保护技术</div><div class="line">集成显卡不支持 纠错</div></pre></td></tr></table></figure></p>
<p><a href="http://detail.zol.com.cn/1142/1141738/param.shtml" target="_blank" rel="noopener">http://detail.zol.com.cn/1142/1141738/param.shtml</a> Intel Xeon E5-2620 v4</p>
<p><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">基本参数    </div><div class="line">CPU系列Xeon E5 v4系列</div><div class="line">制作工艺14纳米</div><div class="line">核心代号Broadwell</div><div class="line">性能参数    </div><div class="line">核心数量八核心</div><div class="line">线程数量十六线程</div><div class="line">CPU主频2.1GHz</div><div class="line">动态加速频率3GHz</div><div class="line">L3缓存20MB</div><div class="line">总线规格QPI 8GT/s</div><div class="line">热设计功耗(TDP)85W</div><div class="line">内存规格    </div><div class="line">支持最大内存容量1536GB</div><div class="line">内存类型DDR4 1600/1866/2133MHz</div><div class="line">封装规格    </div><div class="line">插槽类型LGA 2011-3</div><div class="line">封装大小52.5×51mm</div><div class="line">最高容许温度(Tcase)74°C</div><div class="line">最大CPU配置2颗</div><div class="line">技术参数    </div><div class="line">睿频加速技术支持，2.0</div><div class="line">超线程技术支持</div><div class="line">虚拟化技术Intel VT</div><div class="line">指令集AVX 2.0，64-bit</div><div class="line">64位处理器支持</div><div class="line">其它技术支持博锐技术 ，定向I/O虚拟化技术，增强型SpeedStep技术，按需配电技术，温度监视技术，数据保护技术，平台保护技术</div><div class="line">集成显卡不支持</div></pre></td></tr></table></figure>
</p>
<p><a href="http://detail.zol.com.cn/ProductComp_param_399822-1141732-1141738.html" target="_blank" rel="noopener">http://detail.zol.com.cn/ProductComp_param_399822-1141732-1141738.html</a> </p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://nameless13.github.io/Linux/关于tar解压重命名的问题.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Nameless13">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Nameless13">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/Linux/关于tar解压重命名的问题.html" itemprop="url">关于tar解压重命名的问题</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-05-23T09:57:35+08:00">
                2018-05-23
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Linux/" itemprop="url" rel="index">
                    <span itemprop="name">Linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="关于tar解压重命名的问题"><a href="#关于tar解压重命名的问题" class="headerlink" title="关于tar解压重命名的问题"></a>关于tar解压重命名的问题</h1><h2 id="问题描述："><a href="#问题描述：" class="headerlink" title="问题描述："></a>问题描述：</h2><p><code>wget http://oss.aliyuncs.com/aliyunecs/onekey/mysql/mysql-5.6.15-linux-glibc2.5-i686.tar.gz</code><br>显然下载下来的文件就是：mysql-5.6.15-linux-glibc2.5-i686.tar.gz</p>
<p>有时候这样的文件名不便于shell脚本的自动化操作，在特定条件下你希望将“mysql-5.6.15-linux-glibc2.5-i686.tar.gz” 变为 “mysql-5.6.15.tar.gz”，于是大家都会像下面这样做：</p>
<p><code>wget -O mysql-5.6.15.tar.gz  http://oss.aliyuncs.com/aliyunecs/onekey/mysql/mysql-5.6.15-linux-glibc2.5-i686.tar.gz</code><br>好，现在已经得到了是“mysql-5.6.15.tar.gz”这样的文件名了。但是，接着你将“mysql-5.6.15.tar.gz”解压后就会发现好像不是你想要的，如下：</p>
<p><code>tar -zxvf mysql-5.6.15.tar.gz</code><br>mysql-5.6.15-linux-glibc2.5-i686 （这就是解压后的文件名）</p>
<p>如何保证“mysql-5.6.15.tar.gz”解压后的文件名就是“mysql-5.6.15”呢？</p>
<p>完整解决过程：</p>
<p><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">wget -O mysql-5.6.15.tar.gz  http://oss.aliyuncs.com/aliyunecs/onekey/mysql/mysql-5.6.15-linux-glibc2.5-i686.tar.gz</div><div class="line"></div><div class="line">mkdir ./mysql-5.6.15 &amp;&amp; tar -xzvf mysql-5.6.15.tar.gz -C ./mysql-5.6.15 --strip-components 1</div></pre></td></tr></table></figure>
</p>
<p>这样就得到了“mysql-5.6.15”命名的解压文件。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://nameless13.github.io/Tips/hexo.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Nameless13">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Nameless13">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/Tips/hexo.html" itemprop="url">hexo</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-05-23T09:57:35+08:00">
                2018-05-23
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Tips/" itemprop="url" rel="index">
                    <span itemprop="name">Tips</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="hexo"><a href="#hexo" class="headerlink" title="hexo"></a>hexo</h1><blockquote>
<p><a href="https://hexo.io/zh-cn/docs/index.html" target="_blank" rel="noopener">官方文档</a></p>
</blockquote>
<h3 id="安装前提"><a href="#安装前提" class="headerlink" title="安装前提"></a>安装前提</h3><ul>
<li>node.js</li>
<li>git</li>
</ul>
<p><code>$ npm install -g hexo-cli</code></p>
<p>具体文件作用见官方文档<br> C:\Users\Nameless13\AppData\Roaming\npm\hexo clean<br> C:\Users\Nameless13\AppData\Roaming\npm\hexo generate<br> C:\Users\Nameless13\AppData\Roaming\npm\hexo server</p>
<h2 id="Algolia"><a href="#Algolia" class="headerlink" title="Algolia"></a>Algolia</h2><p><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">node:9751) [DEP0061] DeprecationWarning: fs.SyncWriteStream is deprecated.</div><div class="line">FATAL Something&apos;s wrong. Maybe you can find the solution here: http://hexo.io/docs/troubleshooting.html</div><div class="line">AlgoliaSearchError: Please provide an API key. Usage: algoliasearch(applicationID, apiKey, opts)</div><div class="line">    at AlgoliaSearchNodeJS.AlgoliaSearchCore (/Users/hechangtong/Projects/blog/node_modules/algoliasearch/src/AlgoliaSearchCore.js:55:11)</div><div class="line">    at AlgoliaSearchNodeJS.AlgoliaSearch (/Users/hechangtong/Projects/blog/node_modules/algoliasearch/src/AlgoliaSearch.js:11:21)</div><div class="line">    at AlgoliaSearchNodeJS.AlgoliaSearchServer (/Users/hechangtong/Projects/blog/node_modules/algoliasearch/src/server/builds/AlgoliaSearchServer.js:17:17)</div><div class="line">    at new AlgoliaSearchNodeJS (/Users/hechangtong/Projects/blog/node_modules/algoliasearch/src/server/builds/node.js:79:23)</div><div class="line">    at algoliasearch (/Users/hechangtong/Projects/blog/node_modules/algoliasearch/src/server/builds/node.js:68:10)</div><div class="line">    at Hexo.module.exports (/Users/hechangtong/Projects/blog/node_modules/hexo-algolia/lib/command.js:22:16)</div><div class="line">    at Hexo.tryCatcher (/Users/hechangtong/Projects/blog/node_modules/bluebird/js/release/util.js:16:23)</div><div class="line">    at Hexo.ret (eval at makeNodePromisifiedEval (/usr/local/lib/node_modules/hexo-cli/node_modules/bluebird/js/release/promisify.js:184:12), &lt;anonymous&gt;:13:39)</div><div class="line">    at /Users/hechangtong/Projects/blog/node_modules/hexo/lib/hexo/index.js:195:9</div><div class="line">    at Promise._execute (/Users/hechangtong/Projects/blog/node_modules/bluebird/js/release/debuggability.js:300:9)</div><div class="line">    at Promise._resolveFromExecutor (/Users/hechangtong/Projects/blog/node_modules/bluebird/js/release/promise.js:483:18)</div><div class="line">    at new Promise (/Users/hechangtong/Projects/blog/node_modules/bluebird/js/release/promise.js:79:10)</div><div class="line">    at Hexo.call (/Users/hechangtong/Projects/blog/node_modules/hexo/lib/hexo/index.js:191:10)</div><div class="line">    at /usr/local/lib/node_modules/hexo-cli/lib/hexo.js:66:17</div><div class="line">    at tryCatcher (/usr/local/lib/node_modules/hexo-cli/node_modules/bluebird/js/release/util.js:16:23)</div><div class="line">    at Promise._settlePromiseFromHandler (/usr/local/lib/node_modules/hexo-cli/node_modules/bluebird/js/release/promise.js:512:31)</div><div class="line">    at Promise._settlePromise (/usr/local/lib/node_modules/hexo-cli/node_modules/bluebird/js/release/promise.js:569:18)</div><div class="line">    at Promise._settlePromise0 (/usr/local/lib/node_modules/hexo-cli/node_modules/bluebird/js/release/promise.js:614:10)</div><div class="line">    at Promise._settlePromises (/usr/local/lib/node_modules/hexo-cli/node_modules/bluebird/js/release/promise.js:693:18)</div><div class="line">    at Async._drainQueue (/usr/local/lib/node_modules/hexo-cli/node_modules/bluebird/js/release/async.js:133:16)</div><div class="line">    at Async._drainQueues (/usr/local/lib/node_modules/hexo-cli/node_modules/bluebird/js/release/async.js:143:10)</div><div class="line">    at Immediate.Async.drainQueues (/usr/local/lib/node_modules/hexo-cli/node_modules/bluebird/js/release/async.js:17:14)</div><div class="line">➜  blog export HEXO_ALGOLIA_INDEXING_KEY=xxxxxxxxxxxxx</div><div class="line">➜  blog hexo algolia</div><div class="line">(node:9765) [DEP0061] DeprecationWarning: fs.SyncWriteStream is deprecated.</div><div class="line">INFO  [Algolia] Testing HEXO_ALGOLIA_INDEXING_KEY permissions.</div><div class="line">INFO  Start processing</div><div class="line">INFO  [Algolia] Identified 153 posts to index.</div><div class="line">INFO  [Algolia] Start indexing...</div></pre></td></tr></table></figure>
</p>
<h2 id="Theme"><a href="#Theme" class="headerlink" title="Theme"></a>Theme</h2><p>主题我选择github上Star数最高的(hexo-theme-next)[<a href="https://github.com/theme-next" target="_blank" rel="noopener">https://github.com/theme-next</a>]</p>
<p><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">    modified:   _config.yml</div><div class="line">    modified:   layout/_custom/sidebar.swig</div><div class="line">    modified:   source/css/_custom/custom.styl</div><div class="line">Untracked files:</div><div class="line">  (use &quot;git add &lt;file&gt;...&quot; to include in what will be committed)</div><div class="line">    source/images/avatar.jpg</div></pre></td></tr></table></figure>
</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://nameless13.github.io/CDH/Installation/操作系统镜像初始化(openstack).html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Nameless13">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Nameless13">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/CDH/Installation/操作系统镜像初始化(openstack).html" itemprop="url">操作系统镜像初始化(openstack)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-05-23T09:57:35+08:00">
                2018-05-23
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/CDH/" itemprop="url" rel="index">
                    <span itemprop="name">CDH</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/CDH/Installation/" itemprop="url" rel="index">
                    <span itemprop="name">Installation</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="资源池环境搭建"><a href="#资源池环境搭建" class="headerlink" title="资源池环境搭建"></a>资源池环境搭建</h1><blockquote>
<p>Nameless13</p>
</blockquote>
<h2 id="操作系统配置准备"><a href="#操作系统配置准备" class="headerlink" title="操作系统配置准备"></a>操作系统配置准备</h2><ol>
<li><p>建议对操作系统盘做RAID1[无法满足]</p>
</li>
<li><p>需要配置OS的repository，以便yum可以访问OS镜像[需要 createrepo httpd postgresql91 python-psycopg2 ]</p>
<p><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">Usage: Local YUM  [Adept for RHEL/CentOS]</div><div class="line"></div><div class="line">1. Backup repository. </div><div class="line">find /etc/yum.repos.d/ -name &quot;*.repo&quot; -exec mv &#123;&#125; &#123;&#125;.bak \; </div><div class="line"></div><div class="line">2. Install </div><div class="line">For CentOS6/RHEL6: rpm -ivh --force --nodeps http://10.200.40.49/pub/centos-release-el6.noarch.rpm</div><div class="line">For CentOS7/RHEL7: rpm -ivh --force --nodeps http://10.200.40.49/pub/centos-release-el7.noarch.rpm</div><div class="line"></div><div class="line">3. Update cache </div><div class="line">yum clean all</div><div class="line">yum makecache</div><div class="line"></div><div class="line"></div><div class="line"># Description</div><div class="line"></div><div class="line">系统安全加固:     curl -s http://10.200.40.49/pub/install | bash </div><div class="line">SA安装:   curl -s http://10.200.40.49/pub/sa | bash </div><div class="line">YUM源配置:     curl -s http://10.200.40.49/pub/yum | bash </div><div class="line">OpenSSH升级:  curl -s http://10.200.40.49/pub/ssh7.5 | bash</div></pre></td></tr></table></figure>
</p>
</li>
<li><p>配置静态IP地址[无法满足,DHCP]</p>
</li>
<li><p>需要所有主机/etc/hosts内容一致确保静态DNS解析[相互包含]<br>由于hostname会<br>hostname规范 </p>
<p><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">nm-1   10.150.4.88     10.151.0.185    mysql,hive metastore</div><div class="line">nm-2   10.150.4.96     10.151.0.193    mysql,hive metastore</div><div class="line">nm-3   10.150.4.97     10.151.0.194    [namenode,failover controller,HttpFS,JobHistory Server],ResourceManager</div><div class="line">nm-4   10.150.4.98     10.151.0.195    [namenode,failover controller,HttpFS],ResourceManager</div><div class="line">nm-5   10.150.4.90     10.151.0.187    spark1 history server,(NodeManager)</div><div class="line">nm-6   10.150.4.92     10.151.0.189    impala catalog server,impala statestore,(NodeManager)</div><div class="line">nm-7   10.150.4.89     10.151.0.186    [hue,kerberos ticket renewer],sqoop,ooize,hiveserver2</div><div class="line">nm-8   10.150.4.95     10.151.0.192    spark2 history server,(NodeManager)</div><div class="line">nm-9   10.150.4.94     10.151.0.191    [DataNode],(NodeManager,impala deamon)</div><div class="line">nm-10  10.150.4.93     10.151.0.190    [DataNode],(NodeManager,impala deamon)</div><div class="line">nm-11  10.150.4.86     10.151.0.183    [DataNode],(NodeManager,impala deamon)</div><div class="line">zk-1   10.150.4.85     10.151.0.182    Zookeeper,kerberos server,(NodeManager)</div><div class="line">zk-2   10.150.4.84     10.151.0.181    Zookeeper,kerberos server,(NodeManager) </div><div class="line">zk-3   10.150.4.83     10.151.0.180    Zookeeper,(NodeManager)</div><div class="line">sj-cm  10.150.4.81     10.151.0.147    cm,sentry,haproxy,(NodeManager)</div></pre></td></tr></table></figure>
</p>
</li>
<li><p>需要使用root用户 或者无密码使用sudo权限的其他用户[uid必须保持一致]</p>
</li>
<li><p>关闭并禁用iptables[无需操作]<br>提供的KVM Centos7 的镜像源默认没有开启防火墙</p>
</li>
<li><p>关闭SELinux<br><code>echo &quot;SELINUX=disabled&quot; &gt; /etc/sysconfig/selinux;</code></p>
</li>
<li><p>重启网络服务，并初始化网络[无需操作]<br>由于网络由openstack那边配好所以不需要    <code>/etc/init.d/network restart</code></p>
</li>
<li><p>修改transparent_hugepage参数，这一参数默认值可能会导致CDH性能下降<br><code>echo never &gt; /sys/kernel/mm/transparent_hugepage/enabled</code><br><code>echo never &gt; /sys/kernel/mm/transparent_hugepage/defrag</code><br>同时确保开机自动关闭transparent_hugepage<br><code>vi /etc/rc.d/rc.local</code></p>
<p><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">#!/bin/bash</div><div class="line"># THIS FILE IS ADDED FOR COMPATIBILITY PURPOSES</div><div class="line">#</div><div class="line"># It is highly advisable to create own systemd services or udev rules</div><div class="line"># to run scripts during boot instead of using this file.</div><div class="line">#</div><div class="line"># In contrast to previous versions due to parallel execution during boot</div><div class="line"># this script will NOT be run after all other services.</div><div class="line">#</div><div class="line"># Please note that you must run &apos;chmod +x /etc/rc.d/rc.local&apos; to ensure</div><div class="line"># that this script will be executed during boot.</div><div class="line"></div><div class="line">touch /var/lock/subsys/local</div><div class="line"></div><div class="line">if test -f /sys/kernel/mm/transparent_hugepage/enabled; then</div><div class="line">echo never &gt; /sys/kernel/mm/transparent_hugepage/enabled</div><div class="line">fi</div><div class="line">if test -f /sys/kernel/mm/transparent_hugepage/defrag; then</div><div class="line">echo never &gt; /sys/kernel/mm/transparent_hugepage/defrag</div><div class="line">fi</div></pre></td></tr></table></figure>
</p>
<p>最后给rc.local赋予执行权限 <code>chmod +x /etc/rc.d/rc.local</code></p>
</li>
<li><p>禁用交换内存<br><code>vi /etc/sysctl.conf</code><br>增加一行：vm.swappiness=0<br><code>sudo sysctl vm.swappiness=0</code></p>
<p><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">echo 0 &gt;/proc/sys/vm/swappiness</div><div class="line">echo &apos;vm.swappiness=0&apos;&gt;&gt; /etc/sysctl.conf</div><div class="line">cat /proc/sys/vm/swappiness</div></pre></td></tr></table></figure>
</p>
</li>
<li><p>修改/etc/security/limits.conf或者在/etc/security/limits.d下增加相应的配置文件 </p>
<p><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">* soft noproc 11000</div><div class="line">* hard noproc 11000</div><div class="line">* soft nofile 65535</div><div class="line">* hard nofile 65535</div></pre></td></tr></table></figure>
</p>
</li>
<li><p>需要统一开启ntp服务,并且开机启动<br>在集群中选择一台机器作为ntp服务器，剩余的作为ntp客户端。所有客户端时间与ntp服务器保持同步。<br><code>vi /etc/ntp.conf</code><br>ntp同步ip地址和鹏博士的保持一致:<br>server 64.113.32.5<br>server 216.229.0.179</p>
<p>systemctl start ntpd.service<br>systemctl enable ntpd.service</p>
<p>[root@nm-2 ~]# ntpq -p</p>
<pre><code>remote           refid      st t when poll reach   delay   offset  jitter

</code></pre><p>==============================================================================<br> nist.netservice .ACTS.           1 u    7   64    1  238.736   -7.477   0.000<br> nist1-lnk.binar .ACTS.           1 u    6   64    1  234.281   -6.177   0.000</p>
<p>systemctl disable chronyd 会影响ntp服务的开机启动所以禁用掉了</p>
</li>
</ol>
<ol>
<li><p>同时配置spark2.2需要java8环境+特定的jce包<br>JAVA_HOME=/usr/java/jdk1.8.0_144/<br>创建JDBC存放目录<code>mkdir -p /usr/share/java/</code><br>同时替换为cdh的jce</p>
</li>
<li><p>配置路由连通鹏博士IDC以及Ceph的RGW<br>route add -net 10.200.0.0/16 gw 10.151.0.1<br>route add -net 10.125.137.0/24 gw 10.151.0.1<br>(删除路由 route del -net 10.125.137.0/24 gw 10.150.4.1<br>显示路由 netstat -rn)    </p>
</li>
<li><p>disable ipv6,同时需要配置4个网卡<br>ifcfg-eth1、ifcfg-ens5、ifcfg-ens6，这几个文件的内容与ifcfg-eth0一样，只是里面的device名字不同，取-后面的</p>
</li>
<li><p>RHEL 7 &amp; CentOS 7禁用IPV6<br><a href="http://blog.csdn.net/bluishglc/article/details/41390785" target="_blank" rel="noopener">http://blog.csdn.net/bluishglc/article/details/41390785</a></p>
</li>
<li><p>准备jdbc连接mysql的jar包<br>[root@sj-cm ~]# scp /usr/share/java/mysql-connector-java-5.1.38-bin.jar 10.150.4.89:/usr/share/java/<br>[root@nm-7 ~]# mkdir /usr/share/java<br>[root@nm-7 ~]# ln -s /usr/share/java/mysql-connector-java-5.1.38-bin.jar /usr/share/java/mysql-connector-java.jar</p>
</li>
<li><p>检查文件完整性</p>
<p><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">[root@cm cdh5.13]# ll</div><div class="line">total 1889332</div><div class="line">-rw-r--r-- 1 root root 1934590563 Oct 18 16:13 CDH-5.13.0-1.cdh5.13.0.p0.29-el7.parcel</div><div class="line">-rw-r--r-- 1 root root         41 Oct 18 16:13 CDH-5.13.0-1.cdh5.13.0.p0.29-el7.parcel.sha1</div><div class="line">-rw-r--r-- 1 root root      74072 Oct 18 16:13 manifest.json</div><div class="line">[root@cm cdh5.13]# sha1sum CDH-5.13.0-1.cdh5.13.0.p0.29-el7.parcel</div><div class="line">bef6f3f074e0a88cd79d6d37abc6698471e3d279  CDH-5.13.0-1.cdh5.13.0.p0.29-el7.parcel</div><div class="line">[root@cm cdh5.13]# cat CDH-5.13.0-1.cdh5.13.0.p0.29-el7.parcel.sha1 </div><div class="line">bef6f3f074e0a88cd79d6d37abc6698471e3d279</div></pre></td></tr></table></figure>
</p>
</li>
<li><p>route配置</p>
<p><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">[root@tddp-zk-2 ~]# route</div><div class="line">Kernel IP routing table</div><div class="line">Destination     Gateway         Genmask         Flags Metric Ref    Use Iface</div><div class="line">default         host-10-150-4-1 0.0.0.0         UG    0      0        0 eth1</div><div class="line">10.125.137.0    .               255.255.255.0   UG    0      0        0 ens6</div><div class="line">10.150.4.0      0.0.0.0         255.255.255.0   U     0      0        0 eth1</div><div class="line">10.151.0.0      0.0.0.0         255.255.252.0   U     0      0        0 ens6</div><div class="line">10.200.0.0      .               255.255.0.0     UG    0      0        0 ens6</div><div class="line">169.254.169.254 host-10-150-4-4 255.255.255.255 UGH   0      0        0 eth1</div></pre></td></tr></table></figure>
</p>
</li>
</ol>
<h3 id="节点配置"><a href="#节点配置" class="headerlink" title="节点配置"></a>节点配置</h3><p>CPU    8<br>Memory    64GB<br>Disk    100G<br>Network    2*10Gbits，主备模式绑定</p>
<hr>
<h2 id="mysql-主从配置"><a href="#mysql-主从配置" class="headerlink" title="mysql 主从配置"></a>mysql 主从配置</h2><p>yum install -y wget<br>wget <a href="http://repo.mysql.com/mysql-community-release-el7-5.noarch.rpm" target="_blank" rel="noopener">http://repo.mysql.com/mysql-community-release-el7-5.noarch.rpm</a><br>sudo rpm -ivh mysql-community-release-el7-5.noarch.rpm<br>yum -y update<br>sudo yum install -y mysql-server<br>sudo systemctl start mysqld<br>sudo /usr/bin/mysql_secure_installation</p>
<p><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">CREATE USER &apos;hive&apos;@&apos;%&apos; IDENTIFIED BY &apos;Cloudera@123&apos;;</div><div class="line">create database metastore_test default character set utf8;</div><div class="line">GRANT ALL PRIVILEGES ON metastore_test. * TO &apos;hive&apos;@&apos;%&apos;;</div><div class="line"></div><div class="line">create user &apos;amon&apos;@&apos;%&apos; identified by &apos;Cloudera@123&apos;</div><div class="line">create database amon_test default character set utf8;</div><div class="line">grant all privileges on amon_test.* to &apos;amon&apos;@&apos;%&apos;;</div><div class="line"></div><div class="line">create user &apos;rman&apos;@&apos;%&apos; identified by &apos;Cloudera@123&apos;;</div><div class="line">create database rman_test default character set utf8;</div><div class="line">grant all privileges on rman_test.* to &apos;rman&apos;@&apos;%&apos;;</div><div class="line"></div><div class="line">create user &apos;sentry&apos;@&apos;%&apos; identified by &apos;Cloudera@123&apos;;</div><div class="line">create database sentry_test default character set utf8;</div><div class="line">grant all privileges on sentry_test.* to &apos;sentry&apos;@&apos;%&apos;;</div><div class="line"></div><div class="line">create user &apos;nav&apos;@&apos;%&apos; identified by &apos;Cloudera@123&apos;;</div><div class="line">create database nav_test default character set utf8;</div><div class="line">grant all privileges on nav_test.* to &apos;nav&apos;@&apos;%&apos;;</div><div class="line"></div><div class="line">create user &apos;navms&apos;@&apos;%&apos; identified by &apos;Cloudera@123&apos;;</div><div class="line">create database navms_test default character set utf8;</div><div class="line">grant all privileges on navms_test.* to &apos;navms&apos;@&apos;%&apos;;</div><div class="line"></div><div class="line">create user &apos;cm&apos;@&apos;%&apos; identified by &apos;Cloudera@123&apos;;</div><div class="line">create database cm_test default character set utf8;</div><div class="line">grant all privileges on cm_test.* to &apos;cm&apos;@&apos;%&apos;;</div><div class="line"></div><div class="line">CREATE USER &apos;hue&apos;@&apos;%&apos; IDENTIFIED BY &apos;Cloudera@123&apos;; </div><div class="line">create database hue_test default character set utf8;</div><div class="line">GRANT ALL PRIVILEGES ON hue_test.* TO &apos;hue&apos;@&apos;%&apos;; </div><div class="line"></div><div class="line">CREATE USER &apos;oozie&apos;@&apos;%&apos; IDENTIFIED BY &apos;Cloudera@123&apos;; </div><div class="line">create database oozie_test default character set utf8;</div><div class="line">GRANT ALL PRIVILEGES ON oozie_test.* TO &apos;oozie&apos;@&apos;%&apos;; </div><div class="line">FLUSH PRIVILEGES;</div></pre></td></tr></table></figure>
</p>
<p>[root@nm-1 ~]# vi /etc/my.cnf<br>log-bin=mysql-bin<br>server-id=88<br>binlog_format=MIXED<br>[root@nm-2 ~]# vi /etc/my.cnf</p>
<p>[root@nm-1 ~]# systemctl restart mysqld</p>
<p><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">在Master(172.31.10.118) 主MySQL上创建一个mysnc用户</div><div class="line">用户名：mysync   密码：mysync</div><div class="line">GRANT REPLICATION SLAVE ON *.* TO &apos;mysync&apos;@&apos;%&apos;;</div><div class="line">FLUSH PRIVILEGES;</div></pre></td></tr></table></figure>
</p>
<p><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">CREATE USER &apos;mysync&apos;@&apos;%&apos; IDENTIFIED BY &apos;Cloudera@123&apos;;</div><div class="line">change master to</div><div class="line">master_host=&apos;10.150.4.88&apos;,</div><div class="line">master_user=&apos;mysync&apos;,</div><div class="line">master_password=&apos;mysync&apos;,</div><div class="line">master_log_file=&apos;mysql-bin.000001&apos;,</div><div class="line">master_log_pos=987;</div></pre></td></tr></table></figure>
</p>
<h2 id="CDH软件下载与配置（Cloudera管理器节点）"><a href="#CDH软件下载与配置（Cloudera管理器节点）" class="headerlink" title="CDH软件下载与配置（Cloudera管理器节点）"></a>CDH软件下载与配置（Cloudera管理器节点）</h2><ol>
<li>下载Cloudera管理器需要的rpm包</li>
<li>下载Parcel包（包含了CDH中的Hadoop组件）</li>
<li><p>创建repo文件以支持本地yum的操作</p>
<p><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">[root@cm 5.13.0]# pwd</div><div class="line">/var/www/html/cloudera/cm5/redhat/7/5.13.0</div><div class="line">[root@cm 5.13.0]# ll</div><div class="line">total 1101380</div><div class="line">-rw-r--r-- 1 root root   9787192 Oct 18 16:10 cloudera-manager-agent-5.13.0-1.cm5130.p0.55.el7.x86_64.rpm</div><div class="line">-rw-r--r-- 1 root root 699978252 Oct 18 16:10 cloudera-manager-daemons-5.13.0-1.cm5130.p0.55.el7.x86_64.rpm</div><div class="line">-rw-r--r-- 1 root root      8716 Oct 18 16:10 cloudera-manager-server-5.13.0-1.cm5130.p0.55.el7.x86_64.rpm</div><div class="line">-rw-r--r-- 1 root root     10604 Oct 18 16:10 cloudera-manager-server-db-2-5.13.0-1.cm5130.p0.55.el7.x86_64.rpm</div><div class="line">-rw-r--r-- 1 root root  30604232 Oct 18 16:10 enterprise-debuginfo-5.13.0-1.cm5130.p0.55.el7.x86_64.rpm</div><div class="line">-rw-r--r-- 1 root root  71204325 Oct 18 16:10 jdk-6u31-linux-amd64.rpm</div><div class="line">-rw-r--r-- 1 root root 174163338 Oct 19 15:04 jdk-8u151-linux-x64.rpm</div><div class="line">-rw-r--r-- 1 root root 142039186 Oct 18 16:10 oracle-j2sdk1.7-1.7.0+update67-1.x86_64.rpm</div><div class="line">[root@cm 5.13.0]# createrepo .</div><div class="line">Spawning worker 0 with 1 pkgs</div><div class="line">Spawning worker 1 with 1 pkgs</div><div class="line">Spawning worker 2 with 1 pkgs</div><div class="line">Spawning worker 3 with 1 pkgs</div><div class="line">Spawning worker 4 with 1 pkgs</div><div class="line">Spawning worker 5 with 1 pkgs</div><div class="line">Spawning worker 6 with 1 pkgs</div><div class="line">Spawning worker 7 with 1 pkgs</div><div class="line">Workers Finished</div><div class="line">Saving Primary metadata</div><div class="line">Saving file lists metadata</div><div class="line">Saving other metadata</div><div class="line">Generating sqlite DBs</div><div class="line">Sqlite DBs complete</div></pre></td></tr></table></figure>
</p>
<p><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">[root@cm 5.13.0]# cat /etc/yum.repos.d/cm513.repo </div><div class="line">[cm513]</div><div class="line">name=cm513</div><div class="line">baseurl=http://10.150.4.47/cloudera/cm5/redhat/7/5.13.0/</div><div class="line">enabled=true</div><div class="line">gpgcheck=false</div></pre></td></tr></table></figure>
</p>
</li>
</ol>
<p><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">[root@sj-cm ~]# mkdir /usr/share/java</div><div class="line">[root@sj-cm ~]# ln -s /usr/share/java/mysql-connector-java-5.1.38-bin.jar /usr/share/java/mysql-connector-java.jar</div></pre></td></tr></table></figure>
</p>
<p>Storage: Use S3 for storage of input data and final output, and use HDFS for storage of intermediate data.<br>Compress all data to improve performance.<br>Avoid small files when defining your partitioning strategy.<br>Use Parquet columnar data format on S3.<br>Impala block size: 256 MB<br>Change S3A to “fs.s3a.block.size” to match block size.<br>For information about configuring Hive ETL jobs to use Amazon S3, see Configuring Transient Hive ETL Jobs to Use the Amazon S3 Filesystem in the Cloudera Enterprise documentation.</p>
<p>rgw地址:</p>
<p>10.125.137.30:8080<br>10.125.137.31:8080<br>10.125.137.32:8080</p>
<p>之后做了haproxy</p>
<p>测试用户信息<br>“user”: “umtest2”,<br>“access_key”: “BBBA74VJ69J8I4N0GW3O”,<br>“secret_key”: “eNKTsutRmHR8HHM03Mx3xT6ctaW3Fd+PX75KGatk”</p>
<p>将所有的数据同步到s3上后 替换Defaultfs</p>
<p>检查 hive spark yarn 以及 mapreduce的使用</p>
<p>启用yarn的ha</p>
<h2 id="CDH-core-xml-配置"><a href="#CDH-core-xml-配置" class="headerlink" title="CDH core.xml 配置"></a>CDH core.xml 配置</h2><p>&lt;property&gt;<br>  &lt;name&gt;fs.s3a.access.key&lt;/name&gt;<br>  &lt;value&gt;BBBA74VJ69J8I4N0GW3O&lt;/value&gt;<br>  &lt;description&gt;AWS access key ID. Omit for Role-based authentication.&lt;/description&gt;<br>&lt;/property&gt;

</p>
<p>&lt;property&gt;<br>  &lt;name&gt;fs.s3a.secret.key&lt;/name&gt;<br>  &lt;value&gt;eNKTsutRmHR8HHM03Mx3xT6ctaW3Fd+PX75KGatk&lt;/value&gt;<br>  &lt;description&gt;AWS secret key&lt;/description&gt;<br>&lt;/property&gt;

</p>
<p>&lt;property&gt;<br>  &lt;name&gt;fs.s3a.endpoint&lt;/name&gt;<br>  &lt;value&gt;10.125.137.200:8000&lt;/value&gt;<br>  &lt;description&gt;AWS S3 endpoint to connect to. An up-to-date list is<br>    provided in the AWS Documentation: regions and endpoints. Without this<br>    property, the standard region (s3.amazonaws.com) is assumed.<br>  &lt;/description&gt;<br>&lt;/property&gt;

</p>
<p>&lt;property&gt;<br>  &lt;name&gt;fs.s3a.connection.ssl.enabled&lt;/name&gt;<br>  &lt;value&gt;false&lt;/value&gt;<br>  &lt;description&gt;Enables or disables SSL connections to S3.&lt;/description&gt;<br>&lt;/property&gt;<br>&lt;property&gt;<br>  &lt;name&gt;fs.defaultFS&lt;/name&gt;<br>  &lt;value&gt;s3a://mybucket/&lt;/value&gt;<br>&lt;/property&gt;


</p>
<p>hadoop fs -ls s3a://migu001/</p>
<hr>
<h2 id="问题记录"><a href="#问题记录" class="headerlink" title="问题记录"></a>问题记录</h2><h4 id="用root账户启动spark报错"><a href="#用root账户启动spark报错" class="headerlink" title="用root账户启动spark报错"></a>用root账户启动spark报错</h4><p>&lt;console&gt;:16: error: not found: value sqlContext<br>         import sqlContext.implicits._<br>                ^</p>
<p>&lt;console&gt;:16: error: not found: value sqlContext<br>         import sqlContext.sql<br>                ^</p>
<p>找不到文件系统上对应jar包导致</p>
<p>需要配上JAVA_HOME gateway</p>
<h4 id="用admin账户登入hue测试创建表报错"><a href="#用admin账户登入hue测试创建表报错" class="headerlink" title="用admin账户登入hue测试创建表报错"></a>用admin账户登入hue测试创建表报错</h4><p>[HiveServer2-Handler-Pool: Thread-35]: unable to return groups for user admin<br>PartialGroupNameException The user name ‘admin’ is not found. id: admin: no such user<br>id: admin: no such user</p>
<p>HUE 通过hive 建表 ddl语句成功却没能见到新建的表,因为使用的是admin用户登入 集群中没有admin用户</p>
<h4 id="Oozie缺少js库"><a href="#Oozie缺少js库" class="headerlink" title="Oozie缺少js库"></a>Oozie缺少js库</h4><p>To enable Oozie web console install the Ext JS library.</p>
<p>需要单独去安装这个js library</p>
<h4 id="hue与s3对接"><a href="#hue与s3对接" class="headerlink" title="hue与s3对接"></a>hue与s3对接</h4><p>由于cloudera的hue,我查了源码后发现他们boto的调用根本没有获取port参数 所以私有s3的访问得首先改ini配置文件使得其在web上能显示,至于调用我是直接修改源码写死在代码里</p>
<p>hue_safety_valve_server.ini 的 Hue Server 高级配置代码段（安全阀）</p>
<p><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">[aws]</div><div class="line">[[aws_accounts]]</div><div class="line">[[[default]]]</div><div class="line">#access_key_id_script=&lt;/path/to/access_key_script&gt;</div><div class="line">#secret_access_key_script=&lt;/path/to/secret_key_script&gt;</div><div class="line">#security_token=&lt;your AWS security token&gt;</div><div class="line">allow_environment_credentials=false</div><div class="line">region=&lt;your region, such as us-east-1&gt; </div><div class="line">access_key_id=&lt;your_access_key_id&gt;</div><div class="line">secret_access_key=&lt;your_secret_access_key&gt;</div></pre></td></tr></table></figure>
</p>
<p>CDH5.13版本才有host参数但是依旧没有port<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">[aws]</div><div class="line">[[aws_accounts]]</div><div class="line">[[[default]]]</div><div class="line">host=10.125.137.200:8000</div><div class="line">access_key_id=&apos;BBBA74VJ69J8I4N0GW3O&apos;</div><div class="line">secret_access_key=&apos;eNKTsutRmHR8HHM03Mx3xT6ctaW3Fd+PX75KGatk&apos;</div></pre></td></tr></table></figure></p>
<p><a href="https://www.cloudera.com/documentation/enterprise/release-notes/topics/cm_vd_cdh_package_tarball_513.html#cm_vd_cdh_package_tarball_513" target="_blank" rel="noopener">https://www.cloudera.com/documentation/enterprise/release-notes/topics/cm_vd_cdh_package_tarball_513.html#cm_vd_cdh_package_tarball_513</a><br>[HUE-6539] - [aws] Update AWS config check to connect to endpoint and avoid region check<br>[HUE-6515] - [aws] Do not use a default region if not configured, fallback to standard S3 endpoint</p>
<p>Support the new S3 regions<br><a href="https://issues.cloudera.org/browse/HUE-5851" target="_blank" rel="noopener">https://issues.cloudera.org/browse/HUE-5851</a></p>
<p>仅仅只配置了host会报region_name错误,因为他最后还是会去调用region的连接方式,报错如下:</p>
<p><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">S3 filesystem exception.</div><div class="line">Failed to initialize bucket cache: local variable &apos;region_name&apos; referenced before assignment</div><div class="line"></div><div class="line">INFO Configuration.deprecation: fs.s3a.server-side-encryption-key is deprecated. Instead, use fs.s3a.server-side-encryption.key</div></pre></td></tr></table></figure>
</p>
<p><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">S3 filesystem exception.</div><div class="line"></div><div class="line">The AWS Access Key Id you provided does not exist in our records.</div><div class="line"></div><div class="line"> More Info   View Logs </div><div class="line"></div><div class="line">File Name   Line Number Function Name</div><div class="line">/opt/cloudera/parcels/CDH-5.10.0-1.cdh5.10.0.p0.41/lib/hue/apps/filebrowser/src/filebrowser/views.py    188 view</div><div class="line">/opt/cloudera/parcels/CDH-5.10.0-1.cdh5.10.0.p0.41/lib/hue/apps/filebrowser/src/filebrowser/views.py    415 listdir_paged</div><div class="line">/opt/cloudera/parcels/CDH-5.10.0-1.cdh5.10.0.p0.41/lib/hue/desktop/core/src/desktop/lib/fs/proxyfs.py   101 do_as_user</div><div class="line">/opt/cloudera/parcels/CDH-5.10.0-1.cdh5.10.0.p0.41/lib/hue/desktop/core/src/desktop/lib/fs/proxyfs.py   120 listdir_stats</div><div class="line">/opt/cloudera/parcels/CDH-5.10.0-1.cdh5.10.0.p0.41/lib/hue/desktop/libs/aws/src/aws/s3/__init__.py  52  wrapped</div><div class="line">/opt/cloudera/parcels/CDH-5.10.0-1.cdh5.10.0.p0.41/lib/hue/desktop/libs/aws/src/aws/s3/s3fs.py  256 listdir_stats</div><div class="line">/opt/cloudera/parcels/CDH-5.10.0-1.cdh5.10.0.p0.41/lib/hue/desktop/libs/aws/src/aws/s3/s3fs.py  80  _init_bucket_cache</div></pre></td></tr></table></figure>
</p>
<h4 id="OOZIE-错误"><a href="#OOZIE-错误" class="headerlink" title="OOZIE 错误"></a>OOZIE 错误</h4><p><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">[11/Oct/2017 18:49:38 -0700] middleware   INFO     Processing exception: HTTPConnectionPool(host=&apos;tddp-nm-2&apos;, port=14000): Max retries exceeded with url: /webhdfs/v1/user/hue/oozie/deployments/_%24USER_-oozie-%24JOBID-%24TIME?op=GETFILESTATUS&amp;user.name=hue&amp;doas=hue (Caused by NewConnectionError(&apos;&lt;requests.packages.urllib3.connection.HTTPConnection object at 0x7f42fc0bcd50&gt;: Failed to establish a new connection: [Errno 111] Connection refused&apos;,)): Traceback (most recent call last):</div><div class="line">  File &quot;/opt/cloudera/parcels/CDH-5.10.0-1.cdh5.10.0.p0.41/lib/hue/build/env/lib64/python2.7/site-packages/Django-1.6.10-py2.7.egg/django/core/handlers/base.py&quot;, line 112, in get_response</div><div class="line">    response = wrapped_callback(request, *callback_args, **callback_kwargs)</div><div class="line">  File &quot;/opt/cloudera/parcels/CDH-5.10.0-1.cdh5.10.0.p0.41/lib/hue/build/env/lib64/python2.7/site-packages/Django-1.6.10-py2.7.egg/django/db/transaction.py&quot;, line 371, in inner</div><div class="line">    return func(*args, **kwargs)</div><div class="line">  File &quot;/opt/cloudera/parcels/CDH-5.10.0-1.cdh5.10.0.p0.41/lib/hue/apps/oozie/src/oozie/decorators.py&quot;, line 110, in decorate</div><div class="line">    return view_func(request, *args, **kwargs)</div><div class="line">  File &quot;/opt/cloudera/parcels/CDH-5.10.0-1.cdh5.10.0.p0.41/lib/hue/apps/oozie/src/oozie/views/editor2.py&quot;, line 136, in new_workflow</div><div class="line">    workflow.check_workspace(request.fs, request.user)</div><div class="line">  File &quot;/opt/cloudera/parcels/CDH-5.10.0-1.cdh5.10.0.p0.41/lib/hue/apps/oozie/src/oozie/models2.py&quot;, line 93, in check_workspace</div><div class="line">    create_directories(fs, [REMOTE_SAMPLE_DIR.get()])</div><div class="line">  File &quot;/opt/cloudera/parcels/CDH-5.10.0-1.cdh5.10.0.p0.41/lib/hue/desktop/libs/liboozie/src/liboozie/submission2.py&quot;, line 436, in create_directories</div><div class="line">    if not fs.do_as_user(fs.DEFAULT_USER, fs.exists, directory):</div><div class="line">  File &quot;/opt/cloudera/parcels/CDH-5.10.0-1.cdh5.10.0.p0.41/lib/hue/desktop/core/src/desktop/lib/fs/proxyfs.py&quot;, line 101, in do_as_user</div><div class="line">    return fn(*args, **kwargs)</div><div class="line">  File &quot;/opt/cloudera/parcels/CDH-5.10.0-1.cdh5.10.0.p0.41/lib/hue/desktop/core/src/desktop/lib/fs/proxyfs.py&quot;, line 132, in exists</div><div class="line">    return self._get_fs(path).exists(path)</div><div class="line">  File &quot;/opt/cloudera/parcels/CDH-5.10.0-1.cdh5.10.0.p0.41/lib/hue/desktop/libs/hadoop/src/hadoop/fs/webhdfs.py&quot;, line 253, in exists</div><div class="line">    return self._stats(path) is not None</div><div class="line">  File &quot;/opt/cloudera/parcels/CDH-5.10.0-1.cdh5.10.0.p0.41/lib/hue/desktop/libs/hadoop/src/hadoop/fs/webhdfs.py&quot;, line 241, in _stats</div><div class="line">    raise ex</div><div class="line">WebHdfsException: HTTPConnectionPool(host=&apos;tddp-nm-2&apos;, port=14000): Max retries exceeded with url: /webhdfs/v1/user/hue/oozie/deployments/_%24USER_-oozie-%24JOBID-%24TIME?op=GETFILESTATUS&amp;user.name=hue&amp;doas=hue (Caused by NewConnectionError(&apos;&lt;requests.packages.urllib3.connection.HTTPConnection object at 0x7f42fc0bcd50&gt;: Failed to establish a new connection: [Errno 111] Connection refused&apos;,))</div></pre></td></tr></table></figure>
</p>
<p>因为之前HDFS是旧版本的,我是干掉重新拷到s3上面去</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://nameless13.github.io/Tips/微信公众号采集.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Nameless13">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Nameless13">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/Tips/微信公众号采集.html" itemprop="url">微信公众号采集</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-05-23T09:57:35+08:00">
                2018-05-23
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Tips/" itemprop="url" rel="index">
                    <span itemprop="name">Tips</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>通过搜狗搜索微信公众号然后拿到链接<br>通过fiddler检测手机微信拿到链接。</p>
<p>首先，打开fiddler，然后在电脑端微信上找到要爬取的微信公众号，然后左键点一下就会有一个查看所有历史信息。点击查看历史信息之后我们就会在fiddler上看到一条这样的GET请求：<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">https://mp.weixin.qq.com/mp/getmasssendmsg?__biz=MzI4OTY3MTUyNg==&amp;uin=MTQ5NDc2MzE4MQ%3D%3D&amp;key=9ed1e92b9529bc9a24e90253ee09147d9dbc8de3d4dcc62bf923bb2ec092b91c916834736670d2c9323064b3169960259315b632a5640b5953c26e430ebc0a318ea2fb69e310d6a0d825b88d289c9d22&amp;devicetype=Windows+10&amp;version=6206014b&amp;lang=zh_CN&amp;ascene=7&amp;pass_ticket=RfVlWdojZictLscNXkIW1HTYHt1%2F72zegQ5hLGgHZLYSKAjmYJfTMx56Ql57coFp</div></pre></td></tr></table></figure></p>
<p>在这个前面加上<a href="https://mp.weixin.qq.com后在浏览器中打开整个链接就会发现打开了这个公众号的历史文章了。" target="_blank" rel="noopener">https://mp.weixin.qq.com后在浏览器中打开整个链接就会发现打开了这个公众号的历史文章了。</a><br>多用fiddler抓几次这个链接以及换几个公众号后就会发现，<br>整个链接里面biz应该是微信公众号的标识符，uin应该是微信号的标识，key是腾讯的一个算法。<br>在整个链接里面，如果是抓同一个微信公众号的话，那么只有key是有时效性的，其它的都是不变的。<br>超过一定时间的话，再用这个key打开链接就会发现不能用了，提示请用微信打开了！</p>
<p>通过审查这个链接里面的元素，我们不难发现，已经可以看到文章的链接了，但是问题来了，这个初始链接里依然只有10条最近的文章。这个时候，我们必须往下滑动滚动条才能把剩下的文章全部的显示出来。所以在写程序的时候就需要通过selenium+phahtomJS来链接这个界面并且滑动滚动条，知道滚动条滑到最下面为止了。这样我们再审查元素就可以看到获得了全部的文章链接。 <strong> 注意，文章的链接分别藏在几种标签里面，所以要把他们全部找出来，不然会遗漏的！ </strong>然后把这些链接存起来就好了。</p>
<p>程序<br>大概说一下我的程序思路： 整个流程就是通过selenium+phantomJS链接上面那个链接，通过BeautifulSoup提取页面，利用JS操作滚动条滚到底直到出现没有更多消息为止，最后找到所有链接后输出就行了（记得链接存在几种类型的tag里面，一定要找全）。由于朋友只需要这一个公众号的链接，而且因为同一个公众号的链接只有key在变，所以key就从bash获取就行了，其它的可以写在程序里。我是不是太懒了……..大概思路就是这样，还有很多可以优化的地方…</p>
<p><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">GET /mp/getmasssendmsg?__biz=MzI4OTY3MTUyNg==&amp;uin=MTQ5NDc2MzE4MQ%3D%3D&amp;key=9ed1e92b9529bc9a24e90253ee09147d9dbc8de3d4dcc62bf923bb2ec092b91c916834736670d2c9323064b3169960259315b632a5640b5953c26e430ebc0a318ea2fb69e310d6a0d825b88d289c9d22&amp;devicetype=Windows+10&amp;version=6206014b&amp;lang=zh_CN&amp;ascene=7&amp;pass_ticket=RfVlWdojZictLscNXkIW1HTYHt1%2F72zegQ5hLGgHZLYSKAjmYJfTMx56Ql57coFp HTTP/1.1</div><div class="line">Host: mp.weixin.qq.com</div><div class="line">Connection: keep-alive</div><div class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8</div><div class="line">User-Agent: Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/39.0.2171.95 Safari/537.36 MicroMessenger/6.5.2.501 NetType/WIFI WindowsWechat QBCore/3.43.691.400 QQBrowser/9.0.2524.400</div><div class="line">Accept-Encoding: gzip, deflate</div><div class="line">Accept-Language: zh-CN,zh;q=0.8,en-us;q=0.6,en;q=0.5;q=0.4</div><div class="line">Cookie: wxuin=1494763181; devicetype=Windows10; version=6206014b; lang=zh_CN; pass_ticket=RfVlWdojZictLscNXkIW1HTYHt1/72zegQ5hLGgHZLYSKAjmYJfTMx56Ql57coFp; wap_sid2=CK2N4cgFElxMWjNLejdIaldNa1NUMWdmUzFuTDFRaWZja1NkYkZXQVhZNGpHMVA5T2JOTnd5RjJUZ0tRTmxnVjJzem9QblJ3c2Y1czlzRi1uMUdoV0ExZVdRb0tzTFFEQUFBfjDSiK7VBTgNQAE=; rewardsn=d01dde220f29ddc218b3; wxtokenkey=777</div></pre></td></tr></table></figure>
</p>
<p><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">__biz   MzI4OTY3MTUyNg==</div><div class="line">uin MTQ5NDc2MzE4MQ==</div><div class="line">key 9ed1e92b9529bc9a24e90253ee09147d9dbc8de3d4dcc62bf923bb2ec092b91c916834736670d2c9323064b3169960259315b632a5640b5953c26e430ebc0a318ea2fb69e310d6a0d825b88d289c9d22</div><div class="line">devicetype  Windows 10</div><div class="line">version 6206014b</div><div class="line">lang    zh_CN</div><div class="line">ascene  7</div><div class="line">pass_ticket RfVlWdojZictLscNXkIW1HTYHt1/72zegQ5hLGgHZLYSKAjmYJfTMx56Ql57coFp</div></pre></td></tr></table></figure>
</p>
<p><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">作者：tahr</div><div class="line">链接：https://www.zhihu.com/question/21065229/answer/132993179</div><div class="line">来源：知乎</div><div class="line">著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。</div><div class="line"></div><div class="line">1. 插入本地图片只需要在基础语法的括号中填入图片的位置路径即可，支持绝对路径和相对路径。例如：![avatar](/user/desktop/doge.png)缺点是不灵活不好分享，本地图片的路径更改或丢失都会造成markdown文件调不出图。2.插入网络图片只需要在基础语法的括号中填入图片的网络链接即可，现在已经有很多免费/收费图床和方便传图的小工具可选。例如：![avatar](http://baidu.com/pic/doge.png)缺点是图片存在网络服务器上，非常依赖网络。3.把图片存入markdown文件用base64转码工具把图片转成一段字符串，然后把字符串填到基础格式中链接的那个位置。基础用法：![avatar](data:image/png;base64,iVBORw0......)这个时候会发现插入的这一长串字符串会把整个文章分割开，非常影响编写文章时的体验。如果能够把大段的base64字符串放在文章末尾，然后在文章中通过一个id来调用，文章就不会被分割的这么乱了。就像写论文时的文末的注释和参考文档一样。这个想法可以通过markdown的参考式链接语法来实现。进阶用法如下：文中引用语法：![avatar][doge]文末存储字符串语法：[doge]:data:image/png;base64,iVBORw0......</div></pre></td></tr></table></figure>
</p>
<h3 id="原图"><a href="#原图" class="headerlink" title="原图"></a>原图</h3><p><a href="https://mmbiz.qpic.cn/mmbiz_png/THumz4762QALMjJxts1uZHuPX3WDTGtcnL3lAfyVAicmGmoxRK4MGZbkJkC3Oibxtgg21gaf66NDv1kxUIEhygJA/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1" target="_blank" rel="noopener">https://mmbiz.qpic.cn/mmbiz_png/THumz4762QALMjJxts1uZHuPX3WDTGtcnL3lAfyVAicmGmoxRK4MGZbkJkC3Oibxtgg21gaf66NDv1kxUIEhygJA/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1</a></p>
<p><a href="https://mmbiz.qpic.cn/mmbiz_jpg/Kad3LZzM7n550AK0PmEQ5tx0SfsOcDhTu0xe3h4wHLllzc4oArkQ3IsPWEZibX7ZfNaCzpAkcFIqJFsqTzklYiaw/0" target="_blank" rel="noopener">https://mmbiz.qpic.cn/mmbiz_jpg/Kad3LZzM7n550AK0PmEQ5tx0SfsOcDhTu0xe3h4wHLllzc4oArkQ3IsPWEZibX7ZfNaCzpAkcFIqJFsqTzklYiaw/0</a></p>
<p>得去掉640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1 后面的参数 为0</p>
<p><a href="https://mmbiz.qpic.cn/mmbiz_png/THumz4762QALMjJxts1uZHuPX3WDTGtcXIo6Wu5bYzy8sYCr3JxVkwcxCgfBmIMEMgvRWiaZ4WZianIiaXbSvzsRg/0" target="_blank" rel="noopener">https://mmbiz.qpic.cn/mmbiz_png/THumz4762QALMjJxts1uZHuPX3WDTGtcXIo6Wu5bYzy8sYCr3JxVkwcxCgfBmIMEMgvRWiaZ4WZianIiaXbSvzsRg/0</a></p>
<p><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">2018-03-20 17:41:30: 开始整合(5/10)</div><div class="line">2018-03-20 17:41:30: 地址为： http://mp.weixin.qq.com/s?timestamp=1521538833&amp;src=3&amp;ver=1&amp;signature=jyjSbdPOFF7GbiG-gfMO8btYXG2WZR63CRQ6uFMdAGU4YVsAM9evjQLhdLFgBMW0eE1tKmns0CFMjdKuRWcMP2Kd1PPQrieTxcJaHRaII2zz1hrswnSrKapJqygL8tfcKH0xWC39U6GXE-KsWzkyd2ewFm1GnLhjCylw1epVr9A=</div><div class="line">2018-03-20 17:41:30: 文章简述： 本问主要描述如何使用Sentry实现数据的脱敏（masking of sensitive data elements）</div><div class="line">2018-03-20 17:41:30: 发表时间为： 2018年3月16日原创</div><div class="line">2018-03-20 17:41:30: </div><div class="line">Traceback (most recent call last):</div><div class="line">  File &quot;D:\HCT\wechat-history\hct-crawl.py&quot;, line 245, in &lt;module&gt;</div><div class="line">    weixin_spider(&apos;gh_c4c535955d0f&apos;).run()  </div><div class="line">  File &quot;D:\HCT\wechat-history\hct-crawl.py&quot;, line 217, in run</div><div class="line">    articles_list = self.switch_arctiles_to_list(articles)  </div><div class="line">  File &quot;D:\HCT\wechat-history\hct-crawl.py&quot;, line 99, in switch_arctiles_to_list</div><div class="line">    articles_list.append(self.parse_one_article(article,i,excel_content))  </div><div class="line">  File &quot;D:\HCT\wechat-history\hct-crawl.py&quot;, line 124, in parse_one_article</div><div class="line">    self.save_content_file(contentfiletitle,content)  </div><div class="line">  File &quot;D:\HCT\wechat-history\hct-crawl.py&quot;, line 163, in save_content_file</div><div class="line">    with open(title, &apos;w&apos;) as f:  </div><div class="line">IOError: [Errno 2] No such file or directory: u&apos;gh_c4c535955d0f/\u539f\u521b \u5982\u4f55\u4f7f\u7528Sentry\u5b9e\u73b0Hive/Impala\u7684\u6570\u636e\u8131\u654f_2018\u5e743\u670816\u65e5\u539f\u521b.html&apos;</div><div class="line">[Finished in 110.4s]</div></pre></td></tr></table></figure></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://nameless13.github.io/CDH/Installation/Rebuild CDH.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Nameless13">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Nameless13">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/CDH/Installation/Rebuild CDH.html" itemprop="url">Rebuild CDH</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-05-23T09:57:35+08:00">
                2018-05-23
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/CDH/" itemprop="url" rel="index">
                    <span itemprop="name">CDH</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/CDH/Installation/" itemprop="url" rel="index">
                    <span itemprop="name">Installation</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Rebuild-CDH"><a href="#Rebuild-CDH" class="headerlink" title="Rebuild CDH"></a>Rebuild CDH</h1><h2 id="删除CDH所有组件"><a href="#删除CDH所有组件" class="headerlink" title="删除CDH所有组件"></a>删除CDH所有组件</h2><p><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">service cloudera-scm-server stop</div><div class="line">service cloudera-scm-agent stop</div><div class="line">umount /var/run/cloudera-scm-agent/process</div><div class="line">rm -rf /usr/share/cmf /var/lib/cloudera* /var/cache/zypp/packages/cloudera-* /var/cache/zypp/raw/cloudera-* /var/cache/zypp/solv/cloudera-* /var/log/cloudera-scm-* /var/run/cloudera-scm-* /etc/cloudera-scm-server*</div><div class="line">rpm -qa |grep cloudera</div><div class="line">rpm -e cloudera-manager-agent-5.10.0-1.cm5100.p0.85.el7.x86_64</div><div class="line">rpm -e cloudera-manager-server-5.10.0-1.cm5100.p0.85.el7.x86_64</div><div class="line">rpm -e cloudera-manager-daemons-5.10.0-1.cm5100.p0.85.el7.x86_64</div><div class="line">rm -rf /var/lib/hadoop-* /var/lib/impala /var/lib/solr /var/lib/zookeeper /var/lib/hue /var/lib/oozie  /var/lib/pgsql  /var/lib/sqoop2  /data/dfs/  /data/impala/ /data/yarn/  /dfs/ /impala/ /yarn/  /var/run/hadoop-*/ /var/run/hdfs-*/ /usr/bin/hadoop* /usr/bin/zookeeper* /usr/bin/hbase* /usr/bin/hive* /usr/bin/hdfs /usr/bin/mapred /usr/bin/yarn /usr/bin/sqoop* /usr/bin/oozie /etc/hadoop* /etc/zookeeper* /etc/hive* /etc/hue /etc/impala /etc/sqoop* /etc/oozie /etc/hbase* /etc/hcatalog </div><div class="line">rm -rf /opt/cloudera/parcel-cache /opt/cloudera/parcels</div><div class="line">ps aux|grep  supervisord |grep -v grep | awk &apos;&#123;print &quot;kill -9 &quot; $2&#125;&apos;|sh</div></pre></td></tr></table></figure>
</p>
<h2 id="删除所有datanode以及nodemanager产生的数据-建议直接格盘"><a href="#删除所有datanode以及nodemanager产生的数据-建议直接格盘" class="headerlink" title="删除所有datanode以及nodemanager产生的数据(建议直接格盘)"></a>删除所有datanode以及nodemanager产生的数据(建议直接格盘)</h2><p><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">rm -rf /mnt/sdb1/dfs /mnt/sdc1/dfs /mnt/sdd1/dfs /mnt/sde1/dfs /mnt/sdf1/dfs /mnt/sdg1/dfs /mnt/sdh1/dfs /mnt/sdi1/dfs /mnt/sdj1/dfs /mnt/sdk1/dfs /mnt/sdl1/dfs /mnt/sdm1/dfs /mnt/sdn1/dfs /mnt/sdo1/dfs /mnt/sdp1/dfs /mnt/sdq1/dfs /mnt/sdr1/dfs /mnt/sds1/dfs /mnt/sdt1/dfs /mnt/sdu1/dfs /mnt/sdv1/dfs /mnt/sdw1/dfs /mnt/sdx1/dfs /mnt/sdy1/dfs </div><div class="line">rm -rf /mnt/sdb1/yarn /mnt/sdc1/yarn /mnt/sdd1/yarn /mnt/sde1/yarn /mnt/sdf1/yarn /mnt/sdg1/yarn /mnt/sdh1/yarn /mnt/sdi1/yarn /mnt/sdj1/yarn /mnt/sdk1/yarn /mnt/sdl1/yarn /mnt/sdm1/yarn /mnt/sdn1/yarn /mnt/sdo1/yarn /mnt/sdp1/yarn /mnt/sdq1/yarn /mnt/sdr1/yarn /mnt/sds1/yarn /mnt/sdt1/yarn /mnt/sdu1/yarn /mnt/sdv1/yarn /mnt/sdw1/yarn /mnt/sdx1/yarn /mnt/sdy1/yarn</div></pre></td></tr></table></figure>
</p>
<h2 id="删除数据库"><a href="#删除数据库" class="headerlink" title="删除数据库"></a>删除数据库</h2><p><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">drop database metastore_sj_test;</div><div class="line">drop database amon_sj_test;</div><div class="line">drop database rman_sj_test;</div><div class="line">drop database sentry_sj_test;</div><div class="line">drop database nav_sj_test;</div><div class="line">drop database navms_sj_test;</div><div class="line">drop database cm_sj_test;</div><div class="line">drop database hue_sj_test;</div><div class="line">drop database oozie_sj_test;</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">drop database metastore_test;</div><div class="line">drop database amon_test;</div><div class="line">drop database rman_test;</div><div class="line">drop database sentry_test;</div><div class="line">drop database nav_test;</div><div class="line">drop database navms_test;</div><div class="line">drop database cm_test;</div><div class="line">drop database hue_test;</div><div class="line">drop database oozie_test;</div></pre></td></tr></table></figure>
</p>
<h2 id="重新init数据库"><a href="#重新init数据库" class="headerlink" title="重新init数据库"></a>重新init数据库</h2><p><code>/usr/share/cmf/schema/scm_prepare_database.sh -h 10.151.164.28 mysql cm_sj_test cm Cloudera@123</code></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://nameless13.github.io/CDH/Installation/Linux 修改时区.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Nameless13">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Nameless13">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/CDH/Installation/Linux 修改时区.html" itemprop="url">Linux 修改时区</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-05-23T09:57:35+08:00">
                2018-05-23
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/CDH/" itemprop="url" rel="index">
                    <span itemprop="name">CDH</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/CDH/Installation/" itemprop="url" rel="index">
                    <span itemprop="name">Installation</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="linux-修改时区"><a href="#linux-修改时区" class="headerlink" title="linux 修改时区"></a>linux 修改时区</h1><p>在linux中与时间相关的文件有</p>
<ol>
<li><code>/etc/localtime</code></li>
<li><code>/etc/timezone</code></li>
</ol>
<p>其中，/etc/localtime是用来描述本机时间，而 /etc/timezone是用来描述本机所属的时区。</p>
<h2 id="修改本机时间"><a href="#修改本机时间" class="headerlink" title="修改本机时间"></a>修改本机时间</h2><p><code>cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime</code></p>
<p>在/usr/share/zoneinfo下存放着不同时区格式的时间文件，执行以下命令，可以将本机时间调整至目标时区的时间格式。<br>但是！调整了时间格式，本机所属的时区是保持不变的！</p>
<h2 id="修改本机时区"><a href="#修改本机时区" class="headerlink" title="修改本机时区"></a>修改本机时区</h2><p>在linux中，有一些程序会自己计算时间，不会直接采用带有时区的本机时间格式，会根据UTC时间和本机所属的时区等计算出当前的时间。<br>比如jdk应用，时区为“Etc/UTC”，本机时间改为北京时间，通过java代码中new 出来的时间还是utc时间，所以必须得修正本机的时区。</p>
<p><code>echo &#39;Asia/Shanghai&#39; &gt;/etc/timezone</code></p>
<p>(参考资料)[<a href="http://blog.csdn.net/linuxnews/article/details/51325180" target="_blank" rel="noopener">http://blog.csdn.net/linuxnews/article/details/51325180</a>]</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://nameless13.github.io/CDH/Installation/CentOS7 关闭防火墙,禁用ipv6.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Nameless13">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Nameless13">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/CDH/Installation/CentOS7 关闭防火墙,禁用ipv6.html" itemprop="url">CentOS7 关闭防火墙,禁用ipv6</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-05-23T09:57:35+08:00">
                2018-05-23
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/CDH/" itemprop="url" rel="index">
                    <span itemprop="name">CDH</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/CDH/Installation/" itemprop="url" rel="index">
                    <span itemprop="name">Installation</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="CentOS7-关闭防火墙-禁用ipv6"><a href="#CentOS7-关闭防火墙-禁用ipv6" class="headerlink" title="CentOS7 关闭防火墙,禁用ipv6"></a>CentOS7 关闭防火墙,禁用ipv6</h1><h2 id="CentOS7-关闭防火墙"><a href="#CentOS7-关闭防火墙" class="headerlink" title="CentOS7 关闭防火墙"></a>CentOS7 关闭防火墙</h2><p>firewall-cmd –state #查看默认防火墙状态（关闭后显示notrunning，开启后显示running）</p>
<p><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">[root@localhost network-scripts]# firewall-cmd --state</div><div class="line">running</div><div class="line">[root@localhost network-scripts]# systemctl stop firewalld.service </div><div class="line">[75721.569225] Ebtables v2.0 unregistered</div><div class="line">[root@localhost network-scripts]# systemctl disable firewalld.service</div><div class="line">Removed symlink /etc/systemd/system/multi-user.target.wants/firewalld.service.</div><div class="line">Removed symlink /etc/systemd/system/dbus-org.fedoraproject.FirewallD1.service.</div><div class="line">[root@localhost network-scripts]# firewall-cmd --state</div><div class="line">not running</div></pre></td></tr></table></figure>
</p>
<p>systemctl stop firewalld.service #停止firewall<br>systemctl disable firewalld.service #禁止firewall开机启动</p>
<h2 id="CentOS7禁用ipv6"><a href="#CentOS7禁用ipv6" class="headerlink" title="CentOS7禁用ipv6"></a>CentOS7禁用ipv6</h2><p>vi /etc/default/grub<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">GRUB_TIMEOUT=1</div><div class="line">GRUB_DISTRIBUTOR=&quot;$(sed &apos;s, release .*$,,g&apos; /etc/system-release)&quot;</div><div class="line">GRUB_DEFAULT=saved</div><div class="line">GRUB_DISABLE_SUBMENU=true</div><div class="line">GRUB_TERMINAL=&quot;serial console&quot;</div><div class="line">GRUB_SERIAL_COMMAND=&quot;serial --speed=115200&quot;</div><div class="line">GRUB_CMDLINE_LINUX=&quot;ipv6.disable=1 console=tty0 crashkernel=auto console=ttyS0,115200&quot;</div><div class="line">GRUB_DISABLE_RECOVERY=&quot;true&quot;</div><div class="line">GRUB_DEVICE=LABEL=cloudimg-rootfs</div><div class="line">GRUB_DISABLE_LINUX_UUID=true</div><div class="line">GRUB_TIMEOUT=5</div><div class="line">GRUB_TERMINAL=&quot;serial console&quot;</div><div class="line">GRUB_GFXPAYLOAD_LINUX=text</div><div class="line">GRUB_CMDLINE_LINUX_DEFAULT=&quot;console=tty0 console=ttyS0,115200 no_timer_check&quot;</div><div class="line">GRUB_SERIAL_COMMAND=&quot;serial --speed=115200 --unit=0 --word=8 --parity=no --stop=1&quot;</div><div class="line">GRUB_CMDLINE_LINUX=&quot;nofb nomodeset vga=normal&quot;</div></pre></td></tr></table></figure></p>
<p>grub2-mkconfig -o /boot/grub2/grub.cfg</p>
<p>If the output is 0, IPv6 is enabled.<br>If the output is 1, IPv6 is already disabled.<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">[root@localhost network-scripts]# cat /proc/sys/net/ipv6/conf/all/disable_ipv6</div><div class="line">0</div></pre></td></tr></table></figure></p>
<p>lsmod | grep ipv6</p>
<p><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">cloud-init[1716]: 2018-01-08 10:05:08,907 - url_helper.py[WARNING]: Calling &apos;http://10.151.164.1/latest/meta-data/instance-id&apos; failed [30/120s]: request error [(&apos;Connection aborted.&apos;, error(111, &apos;Connection refused&apos;))]</div></pre></td></tr></table></figure>
</p>
<p>删除cloud-init</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://nameless13.github.io/CDH/Hive/hive元数据库升级脚本.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Nameless13">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Nameless13">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/CDH/Hive/hive元数据库升级脚本.html" itemprop="url">hive元数据库升级脚本</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-05-23T09:57:35+08:00">
                2018-05-23
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/CDH/" itemprop="url" rel="index">
                    <span itemprop="name">CDH</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/CDH/Hive/" itemprop="url" rel="index">
                    <span itemprop="name">Hive</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="hive-元数据库升级脚本"><a href="#hive-元数据库升级脚本" class="headerlink" title="hive 元数据库升级脚本"></a>hive 元数据库升级脚本</h1><p>用于HDFS nameservice变更</p>
<p><code>/opt/cloudera/parcels/CDH/lib/hive/scripts</code></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="https://nameless13.github.io/CDH/Hive/hive 元数据库添加中文字段.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Nameless13">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Nameless13">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/CDH/Hive/hive 元数据库添加中文字段.html" itemprop="url">hive 元数据库添加中文字段</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-05-23T09:57:35+08:00">
                2018-05-23
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/CDH/" itemprop="url" rel="index">
                    <span itemprop="name">CDH</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/CDH/Hive/" itemprop="url" rel="index">
                    <span itemprop="name">Hive</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="hive-元数据库添加中文字段"><a href="#hive-元数据库添加中文字段" class="headerlink" title="hive 元数据库添加中文字段"></a>hive 元数据库添加中文字段</h1><p>alter table COLUMNS_V2 modify column COMMENT varchar(256) character set utf8;</p>
<p>alter table TABLE_PARAMS modify column PARAM_VALUE varchar(4000) character set utf8;</p>
<p>alter table PARTITION_KEYS modify column PKEY_COMMENT varchar(4000) character set utf8;</p>
<p>alter table TBLS modify column <code>VIEW_EXPANDED_TEXT</code> mediumtext character set utf8;</p>
<p>alter table TBLS modify column <code>VIEW_ORIGINAL_TEXT</code> mediumtext character set utf8;</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/17/">17</a><a class="extend next" rel="next" href="/page/4/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="Nameless13" />
          <p class="site-author-name" itemprop="name">Nameless13</p>
           
              <p class="site-description motion-element" itemprop="description">90后，桶装水保洁工程狮，ಥ_ಥ</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">164</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              
                <span class="site-state-item-count">33</span>
                <span class="site-state-item-name">分类</span>
              
            </div>
          

          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        

      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Nameless13</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>



  
  

  
    <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.1"></script>

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script>



  


  




	





  





  






  





  

  

  

  

  

  

</body>
</html>
