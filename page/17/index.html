<!DOCTYPE html>












  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2"/>
<meta name="theme-color" content="#222">












<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />






















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=6.3.0" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.3.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.3.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.3.0">


  <link rel="mask-icon" href="/images/logo.svg?v=6.3.0" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '6.3.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: 'J3OX6892F7',
      apiKey: '38852eb9095216f8f2ada575a06a9cfc',
      indexName: 'Blog',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="─=≡Σ((( つ•̀ω•́)つ，大数据运维工程狮，90后">
<meta property="og:type" content="website">
<meta property="og:title" content="Nameless13">
<meta property="og:url" content="https://nameless13.github.io/page/17/index.html">
<meta property="og:site_name" content="Nameless13">
<meta property="og:description" content="─=≡Σ((( つ•̀ω•́)つ，大数据运维工程狮，90后">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Nameless13">
<meta name="twitter:description" content="─=≡Σ((( つ•̀ω•́)つ，大数据运维工程狮，90后">






  <link rel="canonical" href="https://nameless13.github.io/page/17/"/>



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>Nameless13</title>
  









  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Nameless13</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">
    <a href="/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-home"></i> <br />首页</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">
    <a href="/categories/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-th"></i> <br />分类</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">
    <a href="/archives/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />归档</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-about">
    <a href="/about/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-user"></i> <br />关于</a>
  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />搜索</a>
        </li>
      
    </ul>
  

  
    

  

  
    <div class="site-search">
      
  
  <div class="algolia-popup popup search-popup">
    <div class="algolia-search">
      <div class="algolia-search-input-icon">
        <i class="fa fa-search"></i>
      </div>
      <div class="algolia-search-input" id="algolia-search-input"></div>
    </div>

    <div class="algolia-results">
      <div id="algolia-stats"></div>
      <div id="algolia-hits"></div>
      <div id="algolia-pagination" class="algolia-pagination"></div>
    </div>

    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
  </div>




    </div>
  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://nameless13.github.io/Redis/redis-conf-笔记/redis_version_3.2.4.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Nameless13">
      <meta itemprop="description" content="─=≡Σ((( つ•̀ω•́)つ，大数据运维工程狮，90后">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Nameless13">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/Redis/redis-conf-笔记/redis_version_3.2.4.html" itemprop="url">
                  redis_version_3.2.4
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2016-09-07 00:00:00" itemprop="dateCreated datePublished" datetime="2016-09-07T00:00:00+08:00">2016-09-07</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2017-09-24 13:58:04" itemprop="dateModified" datetime="2017-09-24T13:58:04+08:00">2017-09-24</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/redis/" itemprop="url" rel="index"><span itemprop="name">redis</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/redis/redis-conf-笔记/" itemprop="url" rel="index"><span itemprop="name">redis-conf-笔记</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>redis_version:3.2.4                                                                                     //Redis 服务器版本<br>redis_git_sha1:00000000                                                                                     //Git SHA1<br>redis_git_dirty:0                                                                                   //Git dirty flag<br>redis_build_id:96326b2f9b8cf2d2<br>redis_mode:standalone<br>os:Linux 3.10.0-327.el7.x86_64 x86_64                                                                                   //Redis 服务器的宿主操作系统<br>arch_bits:64                                                                                    // 架构（32 或 64 位）<br>multiplexing_api:epoll                                                                                      // Redis 所使用的事件处理机制<br>gcc_version:4.8.5                                                                                       //编译 Redis 时所使用的 GCC 版本<br>process_id:23278                                                                                    //服务器进程的 PID<br>run_id:f5284394b52327c8697f7bff3995643dcbc2af7b                                                                                     //Redis 服务器的随机标识符（用于 Sentinel 和集群）<br>tcp_port:7380                                                                                   //TCP/IP 监听端口<br>uptime_in_seconds:617                                                                                       //自 Redis 服务器启动以来，经过的秒数<br>uptime_in_days:0                                                                                        // 自 Redis 服务器启动以来，经过的天数<br>hz:10<br>lru_clock:16720581                                                                                      //以分钟为单位进行自增的时钟，用于 LRU 管理<br>executable:/root/redis-server<br>config_file:/etc/redis/7380.conf</p>
<h1 id="Clients"><a href="#Clients" class="headerlink" title="Clients"></a>Clients</h1><p>connected_clients:7                                                  : 已连接客户端的数量（不包括通过从属服务器连接的客户端）<br>client_longest_output_list:0                                                 : 当前连接的客户端当中，最长的输出列表<br>client_biggest_input_buf:0                                                   : 当前连接的客户端当中，最大输入缓存<br>blocked_clients:0                                                : 正在等待阻塞命令（BLPOP、BRPOP、BRPOPLPUSH）的客户端的数量</p>
<h1 id="Memory"><a href="#Memory" class="headerlink" title="Memory"></a>Memory</h1><p>used_memory:6210872                                                  : 由 Redis 分配器分配的内存总量，以字节（byte）为单位<br>used_memory_human:5.92M                                                  : 以人类可读的格式返回 Redis 分配的内存总量<br>used_memory_rss:2621440                                                  : 从操作系统的角度，返回 Redis 已分配的内存总量（俗称常驻集大小）。这个值和 top 、 ps 等命令的输出一致。<br>used_memory_rss_human:2.50M<br>used_memory_peak:6332792                                                 : Redis 的内存消耗峰值（以字节为单位）<br>used_memory_peak_human:6.04M<br>total_system_memory:8087961600<br>total_system_memory_human:7.53G<br>used_memory_lua:37888    Lua 引擎所使用的内存大小（以字节为单位）<br>used_memory_lua_human:37.00K<br>maxmemory:2147483648<br>maxmemory_human:2.00G<br>maxmemory_policy:noeviction<br>mem_fragmentation_ratio:0.42                                                 : used_memory_rss 和 used_memory 之间的比率<br>mem_allocator:jemalloc-4.0.3                                                 : 在编译时指定的， Redis 所使用的内存分配器。可以是 libc 、 jemalloc 或者 tcmalloc </p>
<pre><code>在理想情况下， used_memory_rss 的值应该只比 used_memory 稍微高一点儿。

</code></pre><p>当 rss &gt; used ，且两者的值相差较大时，表示存在（内部或外部的）内存碎片。<br>内存碎片的比率可以通过 mem_fragmentation_ratio 的值看出。<br>当 used &gt; rss 时，表示 Redis 的部分内存被操作系统换出到交换空间了，在这种情况下，操作可能会产生明显的延迟。<br>        Because Redis does not have control over how its allocations are mapped to memory pages, high used_memory_rss is often the result of a spike in memory usage.<br>当 Redis 释放内存时，分配器可能会，也可能不会，将内存返还给操作系统。<br>如果 Redis 释放了内存，却没有将内存返还给操作系统，那么 used_memory 的值可能和操作系统显示的 Redis 内存占用并不一致。<br>查看 used_memory_peak 的值可以验证这种情况是否发生。</p>
<h1 id="Persistence-RDB-和-AOF-的相关信息"><a href="#Persistence-RDB-和-AOF-的相关信息" class="headerlink" title="Persistence                                                    : RDB 和 AOF 的相关信息"></a>Persistence                                                    : RDB 和 AOF 的相关信息</h1><p>loading:0<br>rdb_changes_since_last_save:0<br>rdb_bgsave_in_progress:0<br>rdb_last_save_time:1476337757<br>rdb_last_bgsave_status:ok<br>rdb_last_bgsave_time_sec:0<br>rdb_current_bgsave_time_sec:-1<br>aof_enabled:1<br>aof_rewrite_in_progress:0<br>aof_rewrite_scheduled:0<br>aof_last_rewrite_time_sec:-1<br>aof_current_rewrite_time_sec:-1<br>aof_last_bgrewrite_status:ok<br>aof_last_write_status:ok<br>aof_current_size:0<br>aof_base_size:0<br>aof_pending_rewrite:0<br>aof_buffer_length:0<br>aof_rewrite_buffer_length:0<br>aof_pending_bio_fsync:0<br>aof_delayed_fsync:0</p>
<h1 id="Stats-一般统计信息"><a href="#Stats-一般统计信息" class="headerlink" title="Stats                                                  : 一般统计信息"></a>Stats                                                  : 一般统计信息</h1><p>total_connections_received:9<br>total_commands_processed:3497<br>instantaneous_ops_per_sec:6<br>total_net_input_bytes:180031<br>total_net_output_bytes:12844181<br>instantaneous_input_kbps:0.35<br>instantaneous_output_kbps:1.08<br>rejected_connections:0<br>sync_full:1<br>sync_partial_ok:0<br>sync_partial_err:0<br>expired_keys:0<br>evicted_keys:0<br>keyspace_hits:0<br>keyspace_misses:0<br>pubsub_channels:1<br>pubsub_patterns:0<br>latest_fork_usec:83<br>migrate_cached_sockets:0</p>
<h1 id="Replication-主-从复制信息"><a href="#Replication-主-从复制信息" class="headerlink" title="Replication                                                : 主/从复制信息"></a>Replication                                                : 主/从复制信息</h1><p>role:master<br>connected_slaves:1<br>slave0:ip=192.168.29.136,port=7381,state=online,offset=128863,lag=0<br>master_repl_offset:128863<br>repl_backlog_active:1<br>repl_backlog_size:5242880<br>repl_backlog_first_byte_offset:2<br>repl_backlog_histlen:128862</p>
<h1 id="CPU-CPU-计算量统计信息"><a href="#CPU-CPU-计算量统计信息" class="headerlink" title="CPU                                                : CPU 计算量统计信息"></a>CPU                                                : CPU 计算量统计信息</h1><p>used_cpu_sys:0.33<br>used_cpu_user:0.20<br>used_cpu_sys_children:0.00<br>used_cpu_user_children:0.00</p>
<h1 id="Cluster-Redis-集群信息"><a href="#Cluster-Redis-集群信息" class="headerlink" title="Cluster                                                : Redis 集群信息"></a>Cluster                                                : Redis 集群信息</h1><p>cluster_enabled:0</p>
<h1 id="Keyspace"><a href="#Keyspace" class="headerlink" title="Keyspace"></a>Keyspace</h1>
          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://nameless13.github.io/Redis/redis服务搭建/Redis Sentinel.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Nameless13">
      <meta itemprop="description" content="─=≡Σ((( つ•̀ω•́)つ，大数据运维工程狮，90后">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Nameless13">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/Redis/redis服务搭建/Redis Sentinel.html" itemprop="url">
                  Redis Sentinel
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2016-09-07 00:00:00" itemprop="dateCreated datePublished" datetime="2016-09-07T00:00:00+08:00">2016-09-07</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2017-09-24 13:58:04" itemprop="dateModified" datetime="2017-09-24T13:58:04+08:00">2017-09-24</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/redis/" itemprop="url" rel="index"><span itemprop="name">redis</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/redis/redis服务搭建/" itemprop="url" rel="index"><span itemprop="name">redis服务搭建</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Redis-Sentinel"><a href="#Redis-Sentinel" class="headerlink" title="Redis Sentinel"></a>Redis Sentinel</h1><h2 id="Sentinel介绍"><a href="#Sentinel介绍" class="headerlink" title="Sentinel介绍"></a>Sentinel介绍</h2><p>Sentinel是Redis官方为集群提供的高可用解决方案。 在实际项目中可以使用sentinel去做redis自动故障转移，减少人工介入的工作量。另外sentinel也给客户端提供了监控消息的通知，这样客户端就可根据消息类型去判断服务器的状态，去做对应的适配操作。</p>
<p>Sentinel主要功能列表:</p>
<ul>
<li>Monitoring：Sentinel持续检查集群中的master、slave状态，判断是否存活。</li>
<li>Notification：在发现某个redis实例死的情况下，Sentinel能通过API通知系统管理员或其他程序脚本。</li>
<li>Automatic failover：如果一个master挂掉后，sentinel立马启动故障转移，把某个slave提升为master。其他的slave重新配置指向新master。</li>
<li>Configuration provider：对于客户端来说sentinel通知是有效可信赖的。客户端会连接sentinel去请求当前master的地址，一旦发生故障sentinel会提供新地址给客户端。</li>
</ul>
<h2 id="Sentinel配置"><a href="#Sentinel配置" class="headerlink" title="Sentinel配置"></a>Sentinel配置</h2><p>Sentinel本质上只是一个运行在特殊模式下的redis服务器，通过不同配置来区分提供服务。 sentinel.conf配置：</p>
<table>
<thead>
<tr>
<th style="text-align:left"></th>
<th style="text-align:left">[监控名称]</th>
<th style="text-align:left">[ip]</th>
<th style="text-align:left">[port]</th>
<th style="text-align:left">[多少sentinel同意才发生故障转移]</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">sentinel</td>
<td style="text-align:left">monitor mymaster</td>
<td style="text-align:left">127.0.0.1</td>
<td style="text-align:left">6379</td>
<td style="text-align:left">2</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:left"></th>
<th style="text-align:left">[监控名称]</th>
<th style="text-align:left">[Master多少毫秒后不回应ping命令，就认为master是主观下线状态]</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">sentinel</td>
<td style="text-align:left">down-after-milliseconds mymaster</td>
<td style="text-align:left">60000</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:left"></th>
<th style="text-align:left">[故障转移超时时间]</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">sentinel</td>
<td style="text-align:left">failover-timeout mymaster</td>
<td style="text-align:left">180000</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th style="text-align:left"></th>
<th style="text-align:left">[在执行故障转移时,最多可以有多少个从服务器同时对新的主服务器进行同步]</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">sentinel</td>
<td style="text-align:left">parallel-syncs mymaster</td>
<td style="text-align:left">1</td>
</tr>
</tbody>
</table>
<p>sentinel需要使用redis2.8版本以上，启动如下：<br><code>redis-sentinel sentinel.conf</code><br>启动后Sentinel会：</p>
<ul>
<li>以10秒一次的频率，向被监视的master发送info命令，根据回复获取master当前信息。</li>
<li>以1秒一次的频率，向所有redis服务器、包含sentinel在内发送PING命令，通过回复判断服务器是否在线。</li>
<li>以2秒一次的频率，通过向所有被监视的master，slave服务器发送包含当前sentinel，master信息的消息。</li>
</ul>
<p>另外建议sentinel至少起3个实例以上，并配置2个实例同意即可发生转移。 5个实例，配置3个实例同意以此类推。</p>
<h2 id="故障转移消息接收的3种方式"><a href="#故障转移消息接收的3种方式" class="headerlink" title="故障转移消息接收的3种方式"></a>故障转移消息接收的3种方式</h2><p>Redis服务器一旦发送故障后，sentinel通过raft算法投票选举新master。 故障转移过程可以通过sentinel的API获取/订阅接收事件消息。</p>
<h3 id="脚本接收"><a href="#脚本接收" class="headerlink" title="脚本接收"></a>脚本接收</h3><p>//当故障转移期间，可以指定一个“通知”脚本用来告知系统管理员，当前集群的情况。<br>//脚本被允许执行的最大时间为60秒，如果超时，脚本将会被终止(KILL)<br><code>sentinel notification-script mymaster /var/redis/notify.sh</code><br>//故障转移期之后，配置通知客户端的脚本.<br><code>sentinel client-reconfig-script mymaster /var/redis/notifyReconfig.sh</code></p>
<h3 id="客户端直接接收"><a href="#客户端直接接收" class="headerlink" title="客户端直接接收"></a>客户端直接接收</h3><p>Sentinel的故障转移消息通知使用的是redis发布订阅(详解Redis发布订阅及客户端编程)。就是说在故障转移期间所有产生的事件信息，都通过频道(channel)发布出去。比如我们加台slave服务器，sentinel监听到后会发布加slave的消息到”+slave”频道上，客户端只需要订阅”+slave”频道即可接收到对应消息。</p>
<p>其消息格式如下：<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">[实例类型] [事件服务器名称] [服务器ip] [服务器端口] @[master名称] [ip] [端口]</div><div class="line"></div><div class="line">&lt;instance-type&gt; &lt;name&gt; &lt;ip&gt; &lt;port&gt; @ &lt;master-name&gt; &lt;master-ip&gt; &lt;master-port&gt;</div></pre></td></tr></table></figure></p>
<p>通知消息格式示例：<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">*          //订阅类型， *即订阅所有事件消息。</div><div class="line">-sdown     //消息类型</div><div class="line">slave 127.0.0.1:6379 127.0.0.1 6379 @ mymaster 127.0.0.1 6381</div></pre></td></tr></table></figure></p>
<p>订阅消息示例：<br><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">using (RedisSentinel rs = new RedisSentinel(CurrentNode.Host, CurrentNode.Port))</div><div class="line">            &#123;</div><div class="line">                var redisPubSub = new RedisPubSub(node.Host, node.Port);</div><div class="line">                redisPubSub.OnMessage += OnMessage;</div><div class="line">                redisPubSub.OnSuccess += (msg) =&gt;&#123;&#125;;</div><div class="line">                redisPubSub.OnUnSubscribe += (obj) =&gt;&#123;&#125;;</div><div class="line">                redisPubSub.OnError = (exception) =&gt;&#123; &#125;;</div><div class="line">                redisPubSub.PSubscribe(&quot;*&quot;);</div><div class="line">            &#125;</div></pre></td></tr></table></figure></p>
<h3 id="服务间接接收"><a href="#服务间接接收" class="headerlink" title="服务间接接收"></a>服务间接接收</h3><p>这种方式在第二种基础上扩展了一层，即应用端不直接订阅sentinel。 单独做服务去干这件事情，然后应用端提供API供这个服务回调通知。 这样做的好处在于：</p>
<ul>
<li>减少应用端监听失败出错的可能性。</li>
<li>应用端由主动方变成被动方，降低耦合。</li>
<li>性能提高，轮询变回调。</li>
<li>独立成服务可扩展性更高。</li>
</ul>
<p>比如:</p>
<ol>
<li><p>以后换掉sentinel，我们只需要动服务即可，应用端无需更改。</p>
</li>
<li><p>可以在服务内多增加一层守护线程去主动拉取redis状态，这样可确保即使sentinel不生效，也能及时察觉redis状态，并通知到应用端。 当然这种情况很极端，因为sentinel配的也是多节点，同时挂的几率非常小。 </p>
</li>
</ol>
<p>示例：<br>应用端提供回调API，在这个API逻辑下去刷新内存中的Redis连接。<br><code>http://127.0.0.1/redis/notify.api</code><br>独立服务监控到状况后，调用API通知应用端：<br><code>httprequest.post(&quot;http://127.0.0/redis/notify.api&quot;);</code></p>
<h2 id="整体设计"><a href="#整体设计" class="headerlink" title="整体设计"></a>整体设计</h2>
          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://nameless13.github.io/Redis/redis服务搭建/redis-sentinel docker集群.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Nameless13">
      <meta itemprop="description" content="─=≡Σ((( つ•̀ω•́)つ，大数据运维工程狮，90后">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Nameless13">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/Redis/redis服务搭建/redis-sentinel docker集群.html" itemprop="url">
                  redis-sentinel docker集群
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2016-09-07 00:00:00" itemprop="dateCreated datePublished" datetime="2016-09-07T00:00:00+08:00">2016-09-07</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2017-09-24 13:58:04" itemprop="dateModified" datetime="2017-09-24T13:58:04+08:00">2017-09-24</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/redis/" itemprop="url" rel="index"><span itemprop="name">redis</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/redis/redis服务搭建/" itemprop="url" rel="index"><span itemprop="name">redis服务搭建</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="redis-master"><a href="#redis-master" class="headerlink" title="redis-master"></a>redis-master</h2><p><code>docker run --name redis-master -v /home/testuser/docker/master-redis.conf:/usr/local/etc/master-redis.conf -d -p 16397:16379 redis redis-server /usr/local/etc/master-redis.conf</code></p>
<h2 id="redis-slave"><a href="#redis-slave" class="headerlink" title="redis-slave"></a>redis-slave</h2><p><code>docker run --link redis-master:redis-master -v /home/testuser/docker/slave-redis.conf:/usr/local/etc/slave-redis.conf --name redis-slave1 -d redis redis-server /usr/local/etc/slave-redis.conf</code></p>
<p><code>docker run --link redis-master:redis-master -v /home/testuser/docker/slave-redis.conf:/usr/local/etc/slave-redis.conf --name redis-slave2 -d redis redis-server /usr/local/etc/slave-redis.conf</code></p>
<h4 id="宿主机上如何获得-docker-container-容器的-ip-地址？"><a href="#宿主机上如何获得-docker-container-容器的-ip-地址？" class="headerlink" title="宿主机上如何获得 docker container 容器的 ip 地址？"></a>宿主机上如何获得 docker container 容器的 ip 地址？</h4><p><figure class="highlight bash"><table><tr><td class="code"><pre><div class="line">docker inspect --format=<span class="string">'&#123;&#123;.NetworkSettings.IPAddress&#125;&#125;'</span> [<span class="variable">$CONTAINER_ID</span>]</div></pre></td></tr></table></figure>
</p>
<p>172.17.0.51 mster<br>172.17.0.55 slave1<br>56  2<br>57  3</p>
<p><figure class="highlight bash"><table><tr><td class="code"><pre><div class="line">docker inspect -f <span class="string">'&#123;&#123;.Id&#125;&#125;'</span> [获取的名称或者id]</div></pre></td></tr></table></figure>
</p>
<p><figure class="highlight bash"><table><tr><td class="code"><pre><div class="line">[testuser@CentOS1 docker]$ redis-sentinel 3sentinel.conf &amp;</div><div class="line">[3] 28932</div><div class="line">[testuser@CentOS1 docker]$                 _._                                                  </div><div class="line">           _.-``__ <span class="string">''</span>-._                                             </div><div class="line">      _.-``    `.  `_.  <span class="string">''</span>-._           Redis 3.0.7 (00000000/0) 64 bit</div><div class="line">  .-`` .-```.  ```\/    _.,_ <span class="string">''</span>-._                                   </div><div class="line"> (    <span class="string">'      ,       .-`  | `,    )     Running in sentinel mode</span></div><div class="line"> |`-._`-...-` __...-.``-._|'` _.-<span class="string">'|     Port: 26383</span></div><div class="line"> |    `-._   `._    /     _.-'    |     PID: 28932</div><div class="line">  `-._    `-._  `-./  _.-<span class="string">'    _.-'</span>                                   </div><div class="line"> |`-._`-._    `-.__.-<span class="string">'    _.-'</span>_.-<span class="string">'|                                  </span></div><div class="line"> |    `-._`-._        _.-'_.-<span class="string">'    |           http://redis.io        </span></div><div class="line">  `-._    `-._`-.__.-'_.-<span class="string">'    _.-'</span>                                   </div><div class="line"> |`-._`-._    `-.__.-<span class="string">'    _.-'</span>_.-<span class="string">'|                                  </span></div><div class="line"> |    `-._`-._        _.-'_.-<span class="string">'    |                                  </span></div><div class="line">  `-._    `-._`-.__.-'_.-<span class="string">'    _.-'</span>                                   </div><div class="line">      `-._    `-.__.-<span class="string">'    _.-'</span>                                       </div><div class="line">          `-._        _.-<span class="string">'                                           </span></div><div class="line">              `-.__.-'                                               </div><div class="line"></div><div class="line">28932:X 05 Sep 16:10:12.875 <span class="comment"># Sentinel runid is d1d5d361d1d4c9576d64ab274571361ac963351f</span></div><div class="line">28932:X 05 Sep 16:10:12.875 <span class="comment"># +monitor master redis-master 172.17.0.62 16379 quorum 2</span></div><div class="line">28932:X 05 Sep 16:10:12.876 * +slave slave 172.17.0.63:16379 172.17.0.63 16379 @ redis-master 172.17.0.62 16379</div><div class="line">28932:X 05 Sep 16:10:12.908 * +slave slave 172.17.0.64:16379 172.17.0.64 16379 @ redis-master 172.17.0.62 16379</div><div class="line">28932:X 05 Sep 16:10:12.933 * +sentinel sentinel 172.17.42.1:26381 172.17.42.1 26381 @ redis-master 172.17.0.62 16379</div><div class="line">28932:X 05 Sep 16:10:13.009 * +sentinel sentinel 172.17.42.1:26382 172.17.42.1 26382 @ redis-master 172.17.0.62 16379</div></pre></td></tr></table></figure>
</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://nameless13.github.io/Redis/redis服务搭建/redis服务搭建.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Nameless13">
      <meta itemprop="description" content="─=≡Σ((( つ•̀ω•́)つ，大数据运维工程狮，90后">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Nameless13">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/Redis/redis服务搭建/redis服务搭建.html" itemprop="url">
                  redis服务搭建
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2016-09-07 00:00:00" itemprop="dateCreated datePublished" datetime="2016-09-07T00:00:00+08:00">2016-09-07</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2017-09-24 13:58:04" itemprop="dateModified" datetime="2017-09-24T13:58:04+08:00">2017-09-24</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/redis/" itemprop="url" rel="index"><span itemprop="name">redis</span></a></span>

                
                
                  ，
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/redis/redis服务搭建/" itemprop="url" rel="index"><span itemprop="name">redis服务搭建</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="redis服务搭建"><a href="#redis服务搭建" class="headerlink" title="redis服务搭建"></a>redis服务搭建</h1><h2 id="主机命名"><a href="#主机命名" class="headerlink" title="主机命名"></a>主机命名</h2><ol>
<li>确定操作系统类型<br><code>cat  /etc/issue</code></li>
<li><p>查看当前系统的主机名<code>hostname</code></p>
</li>
<li><p>改/etc/sysconfig下的network文件<code>vi /etc/sysconfig/network</code></p>
<p>把HOSTNAME后面的值改为想要设置的主机名<br><code>NETWORKING=yes
HOSTNAME=CentOS2</code></p>
</li>
</ol>
<p>system network reset</p>
<p>exit 验证</p>
<p>不得重启</p>
<ol>
<li><p>更改/etc下的hosts文件</p>
<p><code>vi /etc/hosts</code><br>然后将localhost.localdomain改为想要设置的主机名。</p>
<pre><code>127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
::1         localhost localhost.localdomain localhost6 localhost6.localdomain6
192.168.29.136  CentOS1
192.168.29.135  CentOS2
192.168.29.134  CentOS3




</code></pre></li>
</ol>
<ol>
<li><code>reboot</code></li>
<li>检查<code>hostname</code></li>
</ol>
<h2 id="时钟同步"><a href="#时钟同步" class="headerlink" title="时钟同步"></a>时钟同步</h2><h3 id="CentOS6"><a href="#CentOS6" class="headerlink" title="CentOS6"></a>CentOS6</h3><ol>
<li><p>检查是否启动时钟同步服务<br>service检查:  <code>service ntpd status</code><br>job 检查 :    <code>crontab -l</code><br>修改定时任务: <code>crontab -e</code> </p>
</li>
<li><p>设置时钟同步:</p>
<ul>
<li>修改 /etc/ntp.conf  加入 ntp server ip<br><code>vi /etc/ntp.conf</code> <code>server 10.200.92.18</code></li>
<li>启动ntp服务:<br><code>service ntpd start</code></li>
<li>设置服务自动启动: <ol>
<li>设置 <code>chkconfig ntpd on</code></li>
<li>检查 <code>chkconfig -list ntpd</code></li>
</ol>
</li>
</ul>
</li>
</ol>
<h3 id="CentOS7"><a href="#CentOS7" class="headerlink" title="CentOS7"></a>CentOS7</h3><ul>
<li>使用rpm检查ntp包是否安装<br>[root@CentOS3 home]# rpm -q ntp<br>ntp-4.2.6p5-22.el7.centos.x86_64</li>
<li>如果已经安装则略过此步，否则使用yum进行安装，并设置系统开机自动启动并启动服务<p><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">yum -y install ntp</div><div class="line">systemctl enable ntpd</div><div class="line">systemctl start ntpd</div></pre></td></tr></table></figure>
</p>
</li>
</ul>
<p>修改完成后重启ntpd服务systemctl restart ntpd</p>
<p>使用ntpq -p 查看网络中的NTP服务器，同时显示客户端和每个服务器的关系</p>
<p>使用ntpstat 命令查看时间同步状态，这个一般需要5-10分钟后才能成功连接和同步。所以，服务器启动后需要稍等下：<br>刚启动的时候，一般是：</p>
<pre><code>unsynchronised
  time server re-starting
   polling server every 8 s





</code></pre><h2 id="操作系统"><a href="#操作系统" class="headerlink" title="操作系统"></a>操作系统</h2><p>CentOS release 6.8 (Final)</p>
<p>CentOS 7</p>
<h2 id="网络"><a href="#网络" class="headerlink" title="网络"></a>网络</h2><h3 id="CentOS-6-8"><a href="#CentOS-6-8" class="headerlink" title="CentOS 6.8:"></a>CentOS 6.8:</h3><pre><code>- 防火墙:
    - 即使生效,重启后失效
        开启: service iptables start
        关闭: service iptables stop
    - 重启后生效
        开启: chkconfig iptables on
        关闭: chkconfig iptables off
- 开启了防火墙时,做如下设置可以仅开启相关端口:
    修改/etc/sysconfig/iptables 文件,添加以下内容:
        -A RH-Firewall-1-INPUT -m state --state NEW -m tcp -p tcp --dport 80 -j ACCEPT 
        -A RH-Firewall-1-INPUT -m state --state NEW -m tcp -p tcp --dport 22 -j ACCEPT


</code></pre><h3 id="CentOS-7-0"><a href="#CentOS-7-0" class="headerlink" title="CentOS 7.0:"></a>CentOS 7.0:</h3><p>CentOS 7.0默认使用的是firewall作为防火墙，这里改为iptables防火墙。<br>firewall：</p>
<pre><code>systemctl start firewalld.service#启动firewall

systemctl stop firewalld.service#停止firewall

systemctl disable firewalld.service#禁止firewall开机启动



</code></pre><h2 id="源码安装redis"><a href="#源码安装redis" class="headerlink" title="源码安装redis"></a>源码安装redis</h2><pre><code>wget http://download.redis.io/releases/redis-3.2.4.tar.gz
tar xzf redis-3.2.4.tar.gz
cd redis-3.2.4
make
make test   //只用单核运行 make test：taskset -c 1 sudo make test
make install
mv redis-3.2.4 redis
mv redis /usr/local/



</code></pre><h2 id="修复3个redis-server-启动警告"><a href="#修复3个redis-server-启动警告" class="headerlink" title="修复3个redis-server 启动警告"></a>修复3个redis-server 启动警告</h2><pre><code>echo 1 &gt; /proc/sys/vm/overcommit_memory
echo never &gt; /sys/kernel/mm/transparent_hugepage/enabled
echo 511 &gt; /proc/sys/net/core/somaxconn


</code></pre><h2 id="开机启动redis"><a href="#开机启动redis" class="headerlink" title="开机启动redis"></a>开机启动redis</h2><p><code>/usr/local/redis/utils/install_server.sh</code><br>第一个参数分别选择7380 7381 26379</p>
<h3 id="26379"><a href="#26379" class="headerlink" title="26379"></a>26379</h3><pre><code>Please select the redis executable path [/usr/local/bin/redis-server] 
+  /usr/local/bin/redis-sentinel



</code></pre><h3 id="关闭实例"><a href="#关闭实例" class="headerlink" title="关闭实例"></a>关闭实例</h3><pre><code>[root@CentOS3 redis]# ps aux|grep redis
root     19874  0.0  0.0 136912  7528 ?        Ssl  15:43   0:00 /usr/local/bin/redis-server 127.0.0.1:7380
root     20178  0.0  0.0 136912  7528 ?        Ssl  15:43   0:00 /usr/local/bin/redis-server 127.0.0.1:7381
root     20541  0.0  0.0 136912  7528 ?        Ssl  15:47   0:00 /usr/local/bin/redis-server 127.0.0.1:26379
root     20705  0.0  0.0 112644   992 pts/2    S+   15:48   0:00 grep --color=auto redis
[root@CentOS3 redis]# redis-cli -p 7380 shutdown
[root@CentOS3 redis]# redis-cli -p 7381 shutdown
[root@CentOS3 redis]# redis-cli -p 26379 shutdown
[root@CentOS3 redis]# ps aux|grep redis
root     20721  0.0  0.0 112644   996 pts/2    S+   15:49   0:00 grep --color=auto redis


</code></pre><p><code>redis-cli -p 7380 shutdown &amp;&amp; redis-cli -p 7381 shutdown &amp;&amp; redis-cli -p 26379 shutdown</code></p>
<h3 id="修改sentinel启动脚本"><a href="#修改sentinel启动脚本" class="headerlink" title="修改sentinel启动脚本"></a>修改sentinel启动脚本</h3><p><code>vim /etc/init.d/redis_26379</code></p>
<pre><code>+  REDISHOSTNAME=&quot;192.168.29.134&quot;

-   $CLIEXEC -p $REDISPORT shutdown
+   $CLIEXEC -h $REDISHOSTNAME -p $REDISPORT shutdown


</code></pre><h2 id="resid-service-config-135-7380"><a href="#resid-service-config-135-7380" class="headerlink" title="resid-service config (135:7380)"></a>resid-service config (135:7380)</h2><pre><code>-  bind 127.0.0.1
+  bind 192.168.29.135   

-  protected-mode yes
+  protected-mode no

-  # unixsocket /tmp/redis.sock
-  # unixsocketperm 700
+  unixsocket /tmp/redis.sock
+  unixsocketperm 700

-  timeout 0 
+  timeout 300

-  tcp-keepalive 300
+  tcp-keepalive 0

-  save 900 1
-  save 300 10
-  save 60 10000
+  #save 900 1
+  #save 300 10
+  #save 60 10000

-  stop-writes-on-bgsave-error yes
+  stop-writes-on-bgsave-error no

-  #repl-ping-slave-period 10
+  repl-ping-slave-period 10

-  # repl-backlog-size 1mb
+  repl-backlog-size 5mb
-  # repl-backlog-ttl 3600
+  repl-backlog-ttl 600

-  #maxclients 10000
+  maxclients 10000

-  # maxmemory &lt;bytes&gt;
+  maxmemory 2gb

-  appendonly no
+  appendonly yes 


</code></pre><h3 id="resid-service-config-135-7381"><a href="#resid-service-config-135-7381" class="headerlink" title="resid-service config (135:7381)"></a>resid-service config (135:7381)</h3><pre><code>cp /etc/redis/7380.conf /etc/redis/7381.conf
vim  /etc/redis/7381.conf

    `:%s/7380/7381/g`   //替换所有的7380为7381


</code></pre><h2 id="redis-sentinal-config-135-26379"><a href="#redis-sentinal-config-135-26379" class="headerlink" title="redis-sentinal config (135:26379)"></a>redis-sentinal config (135:26379)</h2><pre><code>rm -f /etc/redis/26379.conf
cp /usr/local/redis/sentinel.conf /etc/redis/26379.conf
vim /usr/local/redis/26379.conf

    +  daemonize yes
    -  #protected-mode no
    +  protected-mode no
    -  dir /tmp
    +  dir /var/lib/redis/26379
    +  logfile /var/log/redis_26379.log

    -  sentinel monitor mymaster 127.0.0.1 6379 2
    +  sentinel monitor redis136 192.168.29.136 7380 2
    -  sentinel down-after-milliseconds mymaster 30000
    +  sentinel down-after-milliseconds redis136 5000        
    -  sentinel parallel-syncs mymaster 1
    +  sentinel parallel-syncs redis136 1 
    -  sentinel failover-timeout mymaster 180000
    +  sentinel failover-timeout redis136 60000

    +  sentinel monitor redis135 192.168.29.135 7380 2
    +  sentinel down-after-milliseconds redis135 5000
    +  sentinel failover-timeout redis135 60000
    +  sentinel parallel-syncs redis135 1

    +  sentinel monitor redis134 192.168.29.134 7380 2
    +  sentinel down-after-milliseconds redis134 5000
    +  sentinel failover-timeout redis134 60000
    +  sentinel parallel-syncs redis134 1



</code></pre><h2 id="redis部署"><a href="#redis部署" class="headerlink" title="redis部署"></a>redis部署</h2><h3 id="预定分配方案"><a href="#预定分配方案" class="headerlink" title="预定分配方案:"></a>预定分配方案:</h3><pre><code>            192.168.29.134
             +---------+  
             | M1 7380 |
             | R3 7381 |
             | S1      |
             +---------+
192.168.29.136    |    192.168.29.135
  +---------+     |     +---------+
  | M3 7380 |     |     | M2 7380 |  
  | R2 7381 |-----------| R1 7381 |
  | S3      |           | S2      |
  +---------+           +---------+

  Configuration: quorum = 2




</code></pre><h3 id="redis-server实例启动"><a href="#redis-server实例启动" class="headerlink" title="redis-server实例启动:"></a>redis-server实例启动:</h3><pre><code>redis-server /etc/redis/7380.conf
redis-server /etc/redis/7381.conf

netstat -lntpa |grep redis 

</code></pre><h3 id="主从分配"><a href="#主从分配" class="headerlink" title="主从分配"></a>主从分配</h3><p>三台主机实例均启动之后,进行主从配置:</p>
<pre><code>redis-cli -h 192.168.29.134 -p 7381 slaveof 192.168.29.136 7380
redis-cli -h 192.168.29.135 -p 7381 slaveof 192.168.29.134 7380
redis-cli -h 192.168.29.136 -p 7381 slaveof 192.168.29.135 7380


</code></pre><h3 id="redis-sentinel实例启动"><a href="#redis-sentinel实例启动" class="headerlink" title="redis-sentinel实例启动:"></a>redis-sentinel实例启动:</h3><p>最后在三台主机上启动sentinel</p>
<p><code>redis-sentinel /etc/redis/26379.conf</code></p>
<h2 id="检查failover"><a href="#检查failover" class="headerlink" title="检查failover"></a>检查failover</h2><pre><code>redis-cli -h 192.168.29.135 -p 7380  debug sleep 300s
redis-cli -p 26379 sentinel master redis135



</code></pre>
          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/16/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/16/">16</a><span class="page-number current">17</span>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.jpg"
                alt="Nameless13" />
            
              <p class="site-author-name" itemprop="name">Nameless13</p>
              <p class="site-description motion-element" itemprop="description">─=≡Σ((( つ•̀ω•́)つ，大数据运维工程狮，90后</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">164</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">33</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
            </nav>
          

          

          

          
          

          
          

          
            
          
          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Nameless13</span>

  

  
</div>




  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动 v3.4.3</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/theme-next/hexo-theme-next">NexT.Mist</a> v6.3.0</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.3.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.3.0"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.3.0"></script>



  



	





  





  










  




  
  
  
  <link rel="stylesheet" href="/lib/algolia-instant-search/instantsearch.min.css">

  
  
  <script src="/lib/algolia-instant-search/instantsearch.min.js"></script>
  

  <script src="/js/src/algolia-search.js?v=6.3.0"></script>



  

  

  

  

  
  

  

  

  

  

  

</body>
</html>
